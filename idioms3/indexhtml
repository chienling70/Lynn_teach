<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆèªç‰¹è¨“ï¼šå°ç«é¾é€²åŒ–å¤§æŒ‘æˆ°</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            background: linear-gradient(180deg, #ff9966 0%, #ff5e62 100%);
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            color: #fff;
        }

        /* å·¦å´ï¼šå¯¶å¯å¤¢å±•ç¤ºå€ (é€²åŒ–å€) */
        .poke-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(0,0,0,0) 70%);
            position: relative;
        }

        /* å¯¶å¯å¤¢åœ–ç‰‡å®¹å™¨ */
        .poke-container {
            width: 320px;
            height: 320px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .poke-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.6));
            transition: transform 0.3s;
            image-rendering: pixelated;
        }
        
        .poke-name {
            font-size: 36px;
            font-weight: bold;
            margin-top: 20px;
            text-shadow: 2px 2px 0 #000;
        }

        .poke-level {
            font-size: 20px;
            color: #ffd700;
            margin-top: 5px;
            text-shadow: 1px 1px 0 #000;
        }

        /* ç¶“é©—æ¢ */
        .exp-bar-container {
            width: 80%;
            height: 24px;
            background: rgba(0,0,0,0.5);
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #fff;
            overflow: hidden;
            position: relative;
        }
        
        .exp-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #f1c40f, #e67e22);
            transition: width 0.5s ease-out;
        }

        /* é€²åŒ–ç‰¹æ•ˆ */
        .evolving {
            animation: evolveFlash 2s infinite;
        }

        @keyframes evolveFlash {
            0% { filter: brightness(1) drop-shadow(0 0 10px white); transform: scale(1); }
            50% { filter: brightness(100) drop-shadow(0 0 50px white); transform: scale(1.1); }
            100% { filter: brightness(1) drop-shadow(0 0 10px white); transform: scale(1); }
        }

        /* å—å‚·ç‰¹æ•ˆ */
        .hurt { animation: hurtShake 0.5s; filter: grayscale(1) brightness(0.5); }
        @keyframes hurtShake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        /* å³å´ï¼šé¡Œç›®å€ */
        .quiz-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-left: 6px solid #e67e22;
            box-shadow: -10px 0 30px rgba(0,0,0,0.3);
        }

        .question-card {
            width: 100%;
            max-width: 550px;
            text-align: center;
        }

        .q-number { font-size: 18px; color: #7f8c8d; margin-bottom: 10px; font-weight: bold; }
        .q-text { 
            font-size: 26px; 
            font-weight: bold; 
            margin-bottom: 30px; 
            line-height: 1.5; 
            color: #d35400;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid #e67e22;
            color: #d35400;
            font-size: 22px;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: bold;
            box-shadow: 0 5px 0 #d35400;
        }

        .option-btn:hover { background-color: #fce4ec; transform: translateY(-3px); }
        .option-btn:active { transform: translateY(3px); box-shadow: none; }

        /* éŒ¯èª¤å›é¥‹ Modal */
        .modal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            color: white;
            padding: 20px;
        }
        .modal h2 { font-size: 40px; color: #ff5252; margin-bottom: 20px; text-shadow: 2px 2px 0 #000; }
        .modal-content { font-size: 22px; margin-bottom: 30px; line-height: 1.6; max-width: 80%; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; }
        
        .next-btn {
            background: #3498db; color: white; border: none;
            padding: 12px 40px; font-size: 22px; border-radius: 50px;
            cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #2980b9;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }

        /* æœ€çµ‚çµæœ */
        .review-area {
            display: none;
            margin-top: 20px;
            text-align: left;
            width: 100%;
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid #e67e22;
            padding: 15px;
            background: #fff3e0;
            border-radius: 10px;
        }
        .review-item { font-size: 16px; border-bottom: 1px dashed #e67e22; padding: 8px 0; color: #333; }
        .review-wrong { color: #c0392b; text-decoration: line-through; }
        .review-correct { color: #27ae60; font-weight: bold; }

        /* RWD */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .poke-section { min-height: 40vh; padding: 20px; }
            .quiz-section { min-height: 60vh; padding: 20px; border-left: none; border-top: 5px solid #e67e22; }
            .poke-container { width: 180px; height: 180px; }
            .poke-name { font-size: 28px; }
            .q-text { font-size: 20px; }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="poke-section">
        <div class="poke-container">
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/175.png" id="poke-img" class="poke-img">
        </div>
        <div class="poke-name" id="poke-name">ç¥ç§˜çš„è›‹</div>
        <div class="poke-level" id="poke-status">ç­‰å¾…å­µåŒ–...</div>
        
        <div class="exp-bar-container">
            <div class="exp-fill" id="exp-bar"></div>
        </div>
        <div style="margin-top:8px; font-size:14px; opacity:0.9;">é€²åŒ–èƒ½é‡</div>
    </div>

    <div class="quiz-section">
        <div class="question-card" id="quiz-card">
            <div class="q-number">ç¬¬ <span id="q-num">1</span> / 15 é¡Œ</div>
            <div style="color:#7f8c8d; font-size:16px; margin-bottom:5px;">è«‹å•é€™å€‹æ„æ€æ˜¯å“ªå€‹æˆèªï¼Ÿ</div>
            <div class="q-text" id="q-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
            <div class="options-grid" id="options-area"></div>
        </div>

        <div id="end-screen" style="display:none; text-align:center;">
            <h1 style="color:#d35400; font-size: 36px;">ç‰¹è¨“çµæŸï¼</h1>
            <p style="font-size:22px; margin-bottom:20px;">ä½ çš„å¯¶å¯å¤¢æœ€çµ‚å‹æ…‹ï¼š<br><span id="final-form" style="color:#e67e22; font-weight:bold; font-size:36px; text-shadow:1px 1px 0 #eee;"></span></p>
            
            <button class="next-btn" style="background:#7f8c8d; margin-right:10px;" onclick="toggleReview()">æª¢è¦–éŒ¯é¡Œ</button>
            <button class="next-btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
            
            <div id="review-area" class="review-area"></div>
        </div>
    </div>

    <div class="modal" id="feedback-modal">
        <h2 id="fb-title">ğŸ˜¢ ç­”éŒ¯äº†ï¼</h2>
        <div class="modal-content" id="fb-content">
            æ­£ç¢ºç­”æ¡ˆæ˜¯...
        </div>
        <button class="next-btn" onclick="nextQuestion()">ç¹¼çºŒåŠ æ²¹</button>
    </div>

<script>
    // --- éŠæˆ²è³‡æ–™è¨­å®š ---
    
    // é€²åŒ–éšæ®µè¨­å®š (ä¾æ“š15é¡Œèª¿æ•´)
    // 0åˆ†: è›‹, 1åˆ†: å°ç«é¾, 5åˆ†: ç«æé¾, 10åˆ†: å™´ç«é¾, 15åˆ†: è¶…ç´šå™´ç«é¾X
    const evolutionStages = [
        { minScore: 0, name: "ç¥ç§˜çš„è›‹", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/175.png" }, 
        { minScore: 1, name: "å°ç«é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png" },
        { minScore: 5, name: "ç«æé¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/5.png" },
        { minScore: 10, name: "å™´ç«é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png" },
        { minScore: 15, name: "è¶…ç´šå™´ç«é¾ X", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/10034.png" } 
    ];

    // 15é¡Œæˆèªèˆ‡æ„æ€
    const rawQuestions = [
        { idiom: "é‹’èŠ’ç•¢éœ²", meaning: "å¤ªæ„›è¡¨ç¾äº†ï¼Œè¦ºå¾—è‡ªå·±å¾ˆå²å®³ï¼Œå¿ä¸ä½è¦è®“å¤§å®¶éƒ½çŸ¥é“ï¼Œä¸æ‡‚å¾—è¬™è™›ã€‚" },
        { idiom: "ä¸å‡æ€ç´¢", meaning: "æƒ³éƒ½ä¸ç”¨æƒ³ï¼Œé¦¬ä¸Šå°±èƒ½å›ç­”å•é¡Œæˆ–åšå‡ºå‹•ä½œï¼Œåæ‡‰è¶…ç´šå¿«ã€‚" },
        { idiom: "å¼±ä¸ç¦é¢¨", meaning: "èº«é«”ç˜¦ç˜¦å¼±å¼±çš„ï¼Œå¥½åƒé¢¨ä¸€å¹å°±æœƒå€’ä¸‹å»ä¸€æ¨£ã€‚" },
        { idiom: "ä¸€å¿µä¹‹å·®", meaning: "åªå› ç‚ºå¿ƒè£¡ä¸€å€‹å¿µé ­æƒ³éŒ¯äº†ï¼Œçµæœå°±åšéŒ¯äº†äº‹ï¼Œé€ æˆä¸å¥½çš„å¾Œæœã€‚" },
        { idiom: "æ”¯é›¢ç ´ç¢", meaning: "æ±è¥¿ç ´æˆä¸€å¡Šä¸€å¡Šçš„ï¼Œæˆ–æ˜¯äº‹æƒ…äº‚ä¸ƒå…«ç³Ÿï¼Œæ‹¼æ¹Šä¸èµ·ä¾†ã€‚" },
        { idiom: "å§‹ä½œä¿‘è€…", meaning: "ç¬¬ä¸€å€‹å¸¶é ­åšå£äº‹çš„äººï¼ˆå°±æ˜¯é‚£å€‹å¸¶é ­æ—è›‹çš„ï¼ï¼‰ã€‚" },
        { idiom: "ç„¡ç¨æœ‰å¶", meaning: "é€™ç¨®ç‰¹åˆ¥çš„äº‹æƒ…ä¸åªæœ‰ä¸€å€‹ï¼Œå‰›å¥½é‚„æœ‰å¦ä¸€å€‹ä¹Ÿæ˜¯é€™æ¨£ã€‚" },
        { idiom: "èŠ±è¨€å·§èª", meaning: "èªªå¾—å¾ˆå¥½è½ã€å¾ˆè¿·äººï¼Œä½†å…¶å¯¦æ˜¯ç‚ºäº†é¨™äººçš„å‡è©±ã€‚" },
        { idiom: "é¤˜éŸ³ç¹æ¢", meaning: "éŸ³æ¨‚æˆ–æ­Œè²å¯¦åœ¨å¤ªå¥½è½äº†ï¼Œè½å®Œä¹‹å¾Œï¼Œè²éŸ³å¥½åƒé‚„ä¸€ç›´åœ¨è€³é‚ŠéŸ¿è‘—ï¼Œè®“äººå¿˜ä¸æ‰ã€‚" },
        { idiom: "åº¸äººè‡ªæ“¾", meaning: "æ˜æ˜æ²’ä»€éº¼äº‹ï¼Œå»è‡ªå·±åš‡è‡ªå·±ï¼Œæ‰¾éº»ç…©çµ¦è‡ªå·±åšã€‚" },
        { idiom: "æŠ«èŠæ–¬æ£˜", meaning: "ç‚ºäº†é”æˆç›®æ¨™ï¼Œä¸æ€•å›°é›£ï¼ŒæŠŠæ“‹åœ¨è·¯ä¸Šçš„éšœç¤™éƒ½æ¸…é™¤ä¹¾æ·¨ï¼ŒåŠªåŠ›å¾€å‰è¡ã€‚" },
        { idiom: "è››çµ²é¦¬è·¡", meaning: "åƒæ˜¯èœ˜è››çµ²æˆ–é¦¬çš„è…³å°é‚£æ¨£ç´°å°çš„ç·šç´¢ï¼Œé›–ç„¶ä¸æ˜é¡¯ï¼Œä½†å¯ä»¥å¹«å¿™æ‰¾å‡ºçœŸç›¸ã€‚" },
        { idiom: "ä¸€æ¿ä¸€çœ¼", meaning: "åšäº‹éå¸¸å®ˆè¦çŸ©ï¼Œè¦å®šæ€æ¨£å°±æ€æ¨£ï¼Œä¸€é»éƒ½ä¸éš¨ä¾¿é¦¬è™ã€‚" },
        { idiom: "æŒºèº«è€Œå‡º", meaning: "é‡åˆ°å›°é›£æˆ–å±éšªçš„æ™‚å€™ï¼Œå‹‡æ•¢åœ°ç«™å‡ºä¾†å¹«å¿™ï¼Œä¸æœƒèº²åœ¨å¾Œé¢ã€‚" },
        { idiom: "åƒé‡Œéµæ¯›", meaning: "ç¦®ç‰©é›–ç„¶å°å°çš„ã€ä¸è²´é‡ï¼Œä½†æ˜¯ä»£è¡¨äº†å¾ˆæ·±å¾ˆé‡çš„å¿ƒæ„ï¼ˆç¦®è¼•æƒ…æ„é‡ï¼‰ã€‚" }
    ];

    let quizList = [];
    let currentQ = 0;
    let score = 0;
    let currentStageIndex = 0;
    let wrongAnswers = [];
    const totalQuestions = 15;

    // --- éŠæˆ²é‚è¼¯ ---

    window.onload = function() {
        document.getElementById('poke-img').src = evolutionStages[0].img;
        startQuiz();
    };

    function startQuiz() {
        // æ´—ç‰Œé¡Œç›®
        quizList = rawQuestions.map(item => {
            let correct = item.idiom;
            // éš¨æ©Ÿå–3å€‹éŒ¯èª¤é¸é …
            let distractors = rawQuestions
                .filter(x => x.idiom !== correct)
                .map(x => x.idiom)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            let options = [correct, ...distractors].sort(() => 0.5 - Math.random());
            
            return {
                question: item.meaning,
                ans: correct,
                options: options
            };
        }).sort(() => 0.5 - Math.random());

        currentQ = 0;
        score = 0;
        currentStageIndex = 0;
        wrongAnswers = [];
        updateUI();
        loadQuestion();
    }

    function loadQuestion() {
        if(currentQ >= quizList.length) {
            endGame();
            return;
        }

        const qData = quizList[currentQ];
        document.getElementById('q-num').innerText = (currentQ + 1);
        document.getElementById('q-text').innerText = qData.question;
        
        const optsArea = document.getElementById('options-area');
        optsArea.innerHTML = "";

        qData.options.forEach(opt => {
            let btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt);
            optsArea.appendChild(btn);
        });
        
        document.getElementById('feedback-modal').style.display = 'none';
    }

    function checkAnswer(userChoice) {
        const qData = quizList[currentQ];
        
        if (userChoice === qData.ans) {
            score++;
            // ç­”å°å‹•ç•«
            const pokeImg = document.getElementById('poke-img');
            pokeImg.style.transform = "scale(1.2)";
            setTimeout(() => pokeImg.style.transform = "scale(1)", 200);
            
            checkEvolution();
            setTimeout(nextQuestion, 500); 
        } else {
            // ç­”éŒ¯
            wrongAnswers.push({
                q: qData.question,
                user: userChoice,
                ans: qData.ans
            });
            
            // å—å‚·å‹•ç•«
            const pokeImg = document.getElementById('poke-img');
            pokeImg.classList.add('hurt');
            setTimeout(() => pokeImg.classList.remove('hurt'), 500);

            showFeedback(qData);
        }
        updateUI();
    }

    function checkEvolution() {
        let nextStage = currentStageIndex;
        // æª¢æŸ¥æ˜¯å¦é”åˆ°ä¸‹ä¸€éšæ®µé–€æª»
        for (let i = evolutionStages.length - 1; i >= 0; i--) {
            if (score >= evolutionStages[i].minScore) {
                nextStage = i;
                break;
            }
        }

        if (nextStage > currentStageIndex) {
            triggerEvolution(nextStage);
        }
    }

    function triggerEvolution(newStageIndex) {
        const pokeImg = document.getElementById('poke-img');
        const pokeName = document.getElementById('poke-name');
        
        // é€²åŒ–å‹•ç•«é–‹å§‹
        pokeImg.classList.add('evolving');
        
        setTimeout(() => {
            currentStageIndex = newStageIndex;
            const stageData = evolutionStages[currentStageIndex];
            
            // æ›åœ–
            pokeImg.src = stageData.img;
            pokeName.innerText = stageData.name;
            document.getElementById('poke-status').innerText = "é€²åŒ–æˆåŠŸï¼";
            document.getElementById('poke-status').style.color = "#2ecc71";

            // å‹•ç•«çµæŸ
            setTimeout(() => {
                pokeImg.classList.remove('evolving');
                document.getElementById('poke-status').style.color = "#ffd700";
                document.getElementById('poke-status').innerText = "æˆ°é¬¥åŠ›ä¸Šå‡ï¼";
            }, 1000);
            
            // Mega é€²åŒ–ç‘èŠ±
            if (newStageIndex === evolutionStages.length - 1) {
                launchConfetti();
            }

        }, 1500); 
    }

    function updateUI() {
        // æ›´æ–°ç¶“é©—æ¢ (15é¡Œæ»¿)
        const percentage = (score / totalQuestions) * 100;
        document.getElementById('exp-bar').style.width = percentage + "%";
    }

    function showFeedback(qData) {
        const modal = document.getElementById('feedback-modal');
        const content = document.getElementById('fb-content');
        
        content.innerHTML = `æ­£ç¢ºæˆèªæ˜¯ï¼š<br><span style="color:#f1c40f; font-size:32px; font-weight:bold;">${qData.ans}</span><br><br><span style="font-size:18px; color:#ddd;">${qData.question}</span>`;
        
        modal.style.display = 'flex';
    }

    function nextQuestion() {
        currentQ++;
        loadQuestion();
    }

    function endGame() {
        document.getElementById('quiz-card').style.display = 'none';
        const endScreen = document.getElementById('end-screen');
        endScreen.style.display = 'block';
        
        document.getElementById('final-form').innerText = evolutionStages[currentStageIndex].name;
        
        if (score === totalQuestions) {
            launchConfetti();
        }
        
        if (wrongAnswers.length > 0) {
            renderWrongAnswers();
        }
    }

    function renderWrongAnswers() {
        const area = document.getElementById('review-area');
        area.innerHTML = "";
        wrongAnswers.forEach((item, index) => {
            let div = document.createElement('div');
            div.className = 'review-item';
            div.innerHTML = `
                <div style="margin-bottom:5px;">${index+1}. ${item.q}</div>
                <div>ä½ çš„ç­”æ¡ˆï¼š<span class="review-wrong">${item.user}</span> æ­£è§£ï¼š<span class="review-correct">${item.ans}</span></div>
            `;
            area.appendChild(div);
        });
    }

    function toggleReview() {
        const area = document.getElementById('review-area');
        area.style.display = (area.style.display === 'block') ? 'none' : 'block';
    }

    function launchConfetti() {
        var duration = 3 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        function random(min, max) { return Math.random() * (max - min) + min; }
        var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(interval);
            var particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }
</script>

</body>
</html>
