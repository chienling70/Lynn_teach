<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ°´ç®­é¾œé€²åŒ–ï¼šåš´æ ¼ç‰¹è¨“ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #1a237e; /* æ·±æµ·è—èƒŒæ™¯ */
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
            user-select: none;
        }

        /* --- å·¦å´ï¼šå¯¶å¯å¤¢å±•ç¤ºå€ (ä½” 40%) --- */
        .left-panel {
            width: 40%;
            height: 100%;
            background: linear-gradient(180deg, #0d47a1 0%, #1565c0 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 5px solid #4fc3f7;
            position: relative;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            z-index: 2;
        }

        .poke-img-container {
            width: 90%;
            height: 60%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .poke-img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(0, 191, 255, 0.6));
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .poke-info {
            text-align: center;
            color: #fff;
            margin-top: 20px;
        }

        .poke-name {
            font-size: 40px;
            font-weight: 900;
            color: #81d4fa;
            text-shadow: 2px 2px 0 #01579b;
            margin: 0;
        }

        .level-indicator {
            font-size: 20px;
            color: #e1f5fe;
            margin-top: 10px;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid #4fc3f7;
        }

        /* --- å³å´ï¼šéŠæˆ²å€ (ä½” 60%) --- */
        .right-panel {
            width: 60%;
            height: 100%;
            background-color: #e3f2fd; /* æ·ºæ°´è— */
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .game-header {
            padding: 20px;
            background: #0277bd;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-char {
            font-size: 32px;
            font-weight: bold;
        }

        .instruction {
            font-size: 16px;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 10px;
        }

        /* éŠæˆ²æ²å‹•å€ */
        .game-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* é¡Œç›®å®¹å™¨ (è§£é‡‹æ¡†) */
        .targets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .target-box {
            background: #fff;
            border: 3px solid #90caf9;
            border-radius: 20px;
            padding: 20px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #64b5f6;
        }

        /* é¡Œç›®æ–‡å­— (è§£é‡‹) */
        .target-def {
            font-size: 18px;
            color: #01579b;
            line-height: 1.6;
            pointer-events: none;
        }

        /* ç­”å°æ¨£å¼ */
        .target-box.correct {
            border-color: #00bcd4;
            background-color: #e0f7fa;
            box-shadow: 0 0 0 2px #00bcd4;
        }

        /* ç­”éŒ¯æ¨£å¼ (ç¬é–“) */
        .target-box.wrong-flash {
            animation: shake 0.5s;
            border-color: #ff5252;
            background-color: #ffcdd2;
        }

        /* å¡«å…¥å¾Œçš„èªè©é¡¯ç¤º */
        .filled-word {
            margin-top: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            background-color: #00bcd4;
            padding: 5px 20px;
            border-radius: 50px;
            animation: popIn 0.3s;
        }

        /* é¸é …å€ (èªè©) */
        .options-area {
            background: rgba(33, 150, 243, 0.1);
            border: 2px dashed #0288d1;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            min-height: 100px;
        }

        .draggable-item {
            background: #fff;
            color: #0277bd;
            border: 2px solid #0277bd;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 22px;
            font-weight: bold;
            cursor: grab;
            box-shadow: 0 4px 0 #01579b;
            transition: transform 0.1s;
            touch-action: none;
            z-index: 100;
        }

        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.1);
            background: #b3e5fc;
        }

        /* æŒ‰éˆ• */
        .next-btn {
            margin: 0 auto;
            padding: 15px 60px;
            font-size: 24px;
            background: #ffca28; /* é»ƒè‰²æŒ‰éˆ•å°æ¯”è—è‰²èƒŒæ™¯ */
            color: #333;
            border: 4px solid #fff;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #ff6f00;
            display: none;
            animation: pulseBtn 1.5s infinite;
        }

        /* éŒ¯èª¤æç¤º Modal */
        .error-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .error-content {
            background: white;
            width: 80%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border-top: 10px solid #ff5252;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .error-title { color: #ff5252; font-size: 32px; margin-bottom: 20px; font-weight: bold; }
        .error-msg { font-size: 20px; color: #333; line-height: 1.6; margin-bottom: 30px; text-align: left; background:#fafafa; padding:15px; border-radius:10px; border-left: 5px solid #ff5252;}
        .error-btn {
            background: #ff5252; color: white; border: none; padding: 15px 40px;
            font-size: 22px; border-radius: 50px; cursor: pointer; font-weight:bold;
            box-shadow: 0 4px 0 #d32f2f;
        }
        .error-btn:active { transform: translateY(4px); box-shadow: none; }

        /* çµæŸç•«é¢ */
        .end-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; color: white;
        }

        /* å‹•ç•« */
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes evolveFlash { 
            0% { filter: brightness(1) drop-shadow(0 0 10px #00bcd4); } 
            50% { filter: brightness(100) drop-shadow(0 0 50px white); } 
            100% { filter: brightness(1) drop-shadow(0 0 10px #00bcd4); } 
        }
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* RWD èª¿æ•´ */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .left-panel { width: 100%; height: 35vh; border-right: none; border-bottom: 5px solid #4fc3f7; }
            .right-panel { width: 100%; height: 65vh; }
            .poke-name { font-size: 28px; }
            .game-header { padding: 10px; }
            .current-char { font-size: 24px; }
            .targets-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="left-panel">
        <div class="poke-img-container">
            <img src="" id="poke-img" class="poke-img">
        </div>
        <div class="poke-info">
            <h1 class="poke-name" id="poke-name">å‚‘å°¼é¾œ</h1>
            <div class="level-indicator" id="stage-indicator">ç¬¬ 1 / 7 é—œ</div>
        </div>
    </div>

    <div class="right-panel">
        <div class="game-header">
            <div class="current-char" id="level-header">ç¬¬ä¸€é—œï¼šæ½®</div>
            <div class="instruction">å°‡èªè©æ‹–æ‹‰è‡³æ­£ç¢ºè§£é‡‹ (å…¨å°æ‰å¯é€²åŒ–)</div>
        </div>

        <div class="game-content">
            <div class="targets-grid" id="targets-grid">
                </div>

            <div class="options-area" id="options-area">
                </div>

            <button class="next-btn" id="next-btn" onclick="nextLevel()">é€²åŒ–ï¼ä¸‹ä¸€é—œ</button>
        </div>
    </div>

    <div class="error-modal" id="error-modal">
        <div class="error-content">
            <div class="error-title">ğŸ’¥ æŒ‘æˆ°å¤±æ•—ï¼</div>
            <div class="error-msg" id="error-msg-text"></div>
            <button class="error-btn" onclick="resetLevel()">é‡æ–°æŒ‘æˆ°æœ¬é—œ</button>
        </div>
    </div>

    <div class="end-screen" id="end-screen">
        
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/10036.png" style="width:320px; filter: drop-shadow(0 0 20px #00bfff);">
        <h1 style="color:#29b6f6; font-size:40px; margin-top:20px;">ç‰¹è¨“å®Œå…¨åˆ¶éœ¸ï¼</h1>
        <h2>è¶…ç´šæ°´ç®­é¾œ è¦ºé†’ï¼</h2>
        <button class="next-btn" style="display:block; background:#fff; color:#0277bd; margin-top:30px;" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
    </div>

<script>
    // --- éŠæˆ²è³‡æ–™åº« (7é—œ) ---
    const levels = [
        {
            char: "æ½®",
            pairs: [
                { word: "æ½®æ¿•", def: "æ°´æ°£å¾ˆå¤šï¼Œæ¿•æ¿•é»é»çš„æ„Ÿè¦ºã€‚" },
                { word: "æ½®æµ", def: "ç¾åœ¨æœ€æµè¡Œã€å¤§å®¶æœ€å–œæ­¡çš„è¶¨å‹¢ã€‚" },
                { word: "æ½®æ°´", def: "æµ·é‚Šå—åˆ°å¼•åŠ›å½±éŸ¿è€Œæ¼²è½çš„æµ·æ°´ã€‚" },
                { word: "æ¼²æ½®", def: "æµ·æ°´çš„æ°´ä½å‡é«˜ï¼Œè¡åˆ°å²¸é‚Šä¾†ã€‚" },
                { word: "é€€æ½®", def: "æµ·æ°´çš„æ°´ä½é™ä½ï¼Œå‘æµ·ä¸­å¿ƒé€€å»ã€‚" }
            ]
        },
        {
            char: "ç‚¸",
            pairs: [
                { word: "æ²¹ç‚¸", def: "æŠŠé£Ÿç‰©æ”¾é€²æ»¾ç‡™çš„æ²¹è£¡é¢ç…®ç†Ÿï¼ˆä¾‹å¦‚ï¼šç‚¸è–¯æ¢ï¼‰ã€‚" },
                { word: "ç‚¸è—¥", def: "ä¸€ç¨®æœƒå¼•èµ·çˆ†ç‚¸çš„å±éšªç‰©å“ã€‚" },
                { word: "è½Ÿç‚¸", def: "ç”¨ç‚¸å½ˆæ”»æ“Šã€‚" },
                { word: "ç‚¸é–‹", def: "æ±è¥¿çªç„¶çˆ†è£‚é–‹ä¾†ã€‚" }
            ]
        },
        {
            char: "æ—º",
            pairs: [
                { word: "æ—ºç››", def: "ç”Ÿå‘½åŠ›å¾ˆå¼·ï¼Œæˆ–æ˜¯æ°£å‹¢å¾ˆé«˜ï¼ˆä¾‹å¦‚ï¼šç«ç‡’å¾—å¾ˆæ—ºç››ã€ç²¾åŠ›æ—ºç››ï¼‰ã€‚" },
                { word: "èˆˆæ—º", def: "å½¢å®¹ç”Ÿæ„å¾ˆå¥½ï¼Œæˆ–æ˜¯ç™¼å±•å¾—å¾ˆå¥½ã€‚" },
                { word: "æ—ºå­£", def: "ç”Ÿæ„æœ€å¥½ã€å®¢äººæœ€å¤šçš„å­£ç¯€ï¼ˆä¾‹å¦‚ï¼šå¤å¤©æ˜¯å†°åº—çš„æ—ºå­£ï¼‰ã€‚" }
            ]
        },
        {
            char: "çˆ†",
            pairs: [
                { word: "çˆ†ç™¼", def: "çªç„¶ç™¼ç”Ÿï¼ˆä¾‹å¦‚ï¼šç«å±±çˆ†ç™¼ã€ç–«æƒ…çˆ†ç™¼ï¼‰ã€‚" },
                { word: "çˆ†è£‚", def: "æ±è¥¿å—ä¸äº†å£“åŠ›è€Œè£‚é–‹ã€ç‚¸é–‹ã€‚" },
                { word: "å¼•çˆ†", def: "é»ç«è®“ç‚¸å½ˆçˆ†ç‚¸ï¼Œæˆ–æ˜¯å¼•èµ·æŸå€‹äº‹ä»¶ã€‚" },
                { word: "çˆ†æ»¿", def: "äººå¤šåˆ°æ“ æ»¿äº†ï¼Œæ²’æœ‰ç©ºä½ã€‚" }
            ]
        },
        {
            char: "æ¢­",
            pairs: [
                { word: "ç©¿æ¢­", def: "å½¢å®¹ä¾†ä¾†å¾€å¾€ï¼Œå¿«é€Ÿåœ°é€šéï¼ˆä¾‹å¦‚ï¼šè»Šå­åœ¨é¦¬è·¯ä¸Šç©¿æ¢­ï¼‰ã€‚" },
                { word: "å¤ªç©ºæ¢­", def: "ä¸€ç¨®å¯ä»¥é£›åˆ°å¤–å¤ªç©ºä¸­ï¼Œé‚„å¯ä»¥åƒé£›æ©Ÿä¸€æ¨£é£›å›åœ°çƒçš„äº¤é€šå·¥å…·ã€‚" }
            ]
        },
        {
            char: "å¾µ",
            pairs: [
                { word: "ç‰¹å¾µ", def: "ä¸€å€‹äººæˆ–æ±è¥¿ç‰¹åˆ¥çš„åœ°æ–¹ï¼Œè®“äººå®¹æ˜“èªå‡ºä¾†ï¼ˆä¾‹å¦‚ï¼šæ–‘é¦¬çš„ç‰¹å¾µæ˜¯æœ‰é»‘ç™½æ¢ç´‹ï¼‰ã€‚" },
                { word: "å¾µæ±‚", def: "å…¬é–‹è«‹æ±‚å¤§å®¶æä¾›æ±è¥¿æˆ–æ„è¦‹ã€‚" },
                { word: "å¾µå…†", def: "äº‹æƒ…ç™¼ç”Ÿå‰å‡ºç¾çš„è·¡è±¡ï¼ˆä¾‹å¦‚ï¼šçƒé›²å¯†å¸ƒæ˜¯ä¸‹é›¨çš„å¾µå…†ï¼‰ã€‚" },
                { word: "å¾µæ”¶", def: "æ”¿åºœç‚ºäº†å…¬å…±ç”¨é€”ï¼Œä¾æ³•å‘äººæ°‘æ”¶å–åœŸåœ°æˆ–é‡‘éŒ¢ã€‚" },
                { word: "æ‡‰å¾µ", def: "å»é¢è©¦ï¼Œç”³è«‹æƒ³è¦çš„å·¥ä½œã€‚" }
            ]
        },
        {
            char: "æš",
            pairs: [
                { word: "è¡¨æš", def: "å…¬é–‹ç¨±è®šåšå°äº‹æˆ–è¡¨ç¾å¥½çš„äººã€‚" },
                { word: "å®£æš", def: "å¤§è²æˆ–å…¬é–‹åœ°å‚³æ’­ï¼Œè®“å¤§å®¶çŸ¥é“ã€‚" },
                { word: "é£„æš", def: "åœ¨é¢¨ä¸­è¼•è¼•é£›èˆçš„æ¨£å­ï¼ˆä¾‹å¦‚ï¼šåœ‹æ——åœ¨ç©ºä¸­é£„æšï¼‰ã€‚" },
                { word: "è®šæš", def: "ç¨±è®šã€èª‡çã€‚" }
            ]
        }
    ];

    // --- æ°´ç®­é¾œé€²åŒ–è¨­å®š ---
    const stages = [
        // Squirtle ID 7
        
        { name: "å‚‘å°¼é¾œ", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/7.png" },
        // Wartortle ID 8
        
        { name: "å¡å’ªé¾œ", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/8.png" },
        // Blastoise ID 9
        
        { name: "æ°´ç®­é¾œ", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/9.png" }
    ];

    let currentLevelIdx = 0;
    let matchesFound = 0;

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        loadLevel();
    };

    function loadLevel() {
        const levelData = levels[currentLevelIdx];
        
        // æ›´æ–°æ¨™é¡Œ
        const chineseNums = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ"];
        document.getElementById('level-header').innerText = `ç¬¬${chineseNums[currentLevelIdx]}é—œï¼š${levelData.char}`;
        
        document.getElementById('stage-indicator').innerText = `ç¬¬ ${currentLevelIdx + 1} / 7 é—œ`;
        document.getElementById('next-btn').style.display = 'none';
        matchesFound = 0;

        // æ›´æ–°å·¦å´å¯¶å¯å¤¢
        updatePokemon();

        // å»ºç«‹é¡Œç›®å€ (Target Boxes)
        const targetsGrid = document.getElementById('targets-grid');
        targetsGrid.innerHTML = '';
        
        levelData.pairs.forEach(pair => {
            let box = document.createElement('div');
            box.className = 'target-box';
            box.dataset.answer = pair.word; 
            
            let defText = document.createElement('div');
            defText.className = 'target-def';
            defText.innerText = pair.def;
            box.appendChild(defText);

            // è¨»å†Šæ”¾ç½®äº‹ä»¶
            box.addEventListener('dragover', handleDragOver);
            box.addEventListener('drop', handleDrop);
            
            targetsGrid.appendChild(box);
        });

        // å»ºç«‹é¸é …å€ (Draggables)
        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = '';
        
        let shuffledPairs = [...levelData.pairs].sort(() => 0.5 - Math.random());
        
        shuffledPairs.forEach(pair => {
            let item = document.createElement('div');
            item.className = 'draggable-item';
            item.draggable = true;
            item.innerText = pair.word;
            
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('touchstart', handleTouchStart, {passive: false});
            item.addEventListener('touchmove', handleTouchMove, {passive: false});
            item.addEventListener('touchend', handleTouchEnd);

            optionsArea.appendChild(item);
        });
    }

    function updatePokemon() {
        const img = document.getElementById('poke-img');
        const nameEl = document.getElementById('poke-name');
        let stage = 0;
        
        // 0-1é—œ: å‚‘å°¼é¾œ
        // 2-3é—œ: å¡å’ªé¾œ
        // 4-6é—œ: æ°´ç®­é¾œ
        if (currentLevelIdx >= 2 && currentLevelIdx < 4) stage = 1;
        if (currentLevelIdx >= 4) stage = 2;

        if (img.src !== stages[stage].img) {
            img.classList.add('evolving');
            setTimeout(() => {
                img.src = stages[stage].img;
                nameEl.innerText = stages[stage].name;
                img.classList.remove('evolving');
            }, 500);
        } else {
            img.src = stages[stage].img;
            nameEl.innerText = stages[stage].name;
        }
    }

    // --- æ‹–æ›³é‚è¼¯ ---
    let draggedItem = null;

    function handleDragStart(e) {
        draggedItem = e.target;
        e.dataTransfer.setData('text/plain', e.target.innerText);
    }

    function handleDragOver(e) {
        e.preventDefault(); 
        if (!e.currentTarget.classList.contains('correct')) {
            e.currentTarget.style.borderColor = '#00bcd4';
        }
    }

    function handleDrop(e) {
        e.preventDefault();
        const box = e.currentTarget;
        if (!box.classList.contains('correct')) {
            box.style.borderColor = '#90caf9';
        }
        const word = e.dataTransfer.getData('text/plain');
        checkAnswer(box, word, draggedItem);
    }

    // --- è§¸æ§é‚è¼¯ ---
    let touchItem = null;

    function handleTouchStart(e) {
        e.preventDefault();
        touchItem = e.target;
        touchItem.style.position = 'fixed';
        touchItem.style.opacity = '0.8';
        touchItem.style.zIndex = '1000';
        const touch = e.touches[0];
        touchItem.style.left = (touch.clientX - touchItem.offsetWidth / 2) + 'px';
        touchItem.style.top = (touch.clientY - touchItem.offsetHeight / 2) + 'px';
    }

    function handleTouchMove(e) {
        if (!touchItem) return;
        e.preventDefault();
        const touch = e.touches[0];
        touchItem.style.left = (touch.clientX - touchItem.offsetWidth / 2) + 'px';
        touchItem.style.top = (touch.clientY - touchItem.offsetHeight / 2) + 'px';
    }

    function handleTouchEnd(e) {
        if (!touchItem) return;
        const touch = e.changedTouches[0];
        touchItem.style.display = 'none';
        let elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
        touchItem.style.display = 'block';

        let box = elemBelow ? elemBelow.closest('.target-box') : null;

        if (box) {
            checkAnswer(box, touchItem.innerText, touchItem);
        } else {
            resetItemStyle(touchItem);
        }
        touchItem = null;
    }

    function resetItemStyle(item) {
        item.style.position = 'static';
        item.style.opacity = '1';
        item.style.zIndex = '100';
    }

    // --- æ ¸å¿ƒï¼šæª¢æŸ¥ç­”æ¡ˆ (åš´æ ¼æ¨¡å¼) ---
    function checkAnswer(box, userWord, itemEl) {
        if (box.classList.contains('correct')) {
            if(itemEl.style.position === 'fixed') resetItemStyle(itemEl);
            return;
        }

        const correctWord = box.dataset.answer;

        if (userWord === correctWord) {
            // --- ç­”å° ---
            box.classList.add('correct');
            let filledDiv = document.createElement('div');
            filledDiv.className = 'filled-word';
            filledDiv.innerText = userWord;
            box.appendChild(filledDiv);
            itemEl.remove();
            
            matchesFound++;
            
            if (matchesFound === levels[currentLevelIdx].pairs.length) {
                launchConfetti();
                document.getElementById('next-btn').style.display = 'block';
            }

        } else {
            // --- ç­”éŒ¯ (è§¸ç™¼é‡ç½®) ---
            if(itemEl.style.position === 'fixed') resetItemStyle(itemEl);
            
            box.classList.add('wrong-flash');
            setTimeout(() => box.classList.remove('wrong-flash'), 500);

            showErrorReason(userWord, correctWord);
        }
    }

    function showErrorReason(userWord, correctWord) {
        const modal = document.getElementById('error-modal');
        const msgText = document.getElementById('error-msg-text');
        
        msgText.innerHTML = `
            ä½ é¸æ“‡äº†ï¼š<span style="color:#e65100; font-weight:bold; font-size:24px;">${userWord}</span><br><br>
            ä½†é€™è£¡çš„æ­£ç¢ºç­”æ¡ˆå…¶å¯¦æ˜¯ï¼š<br>
            <span style="color:#00c853; font-weight:bold; font-size:28px;">${correctWord}</span><br><br>
            <span style="font-size:16px; color:#555;">(å¿…é ˆå…¨éƒ¨ç­”å°æ‰èƒ½é€²åŒ–ï¼Œè«‹é‡æ–°æŒ‘æˆ°æœ¬é—œï¼)</span>
        `;
        
        modal.style.display = 'flex';
    }

    function resetLevel() {
        document.getElementById('error-modal').style.display = 'none';
        loadLevel(); // é‡æ–°è¼‰å…¥
    }

    function nextLevel() {
        currentLevelIdx++;
        if (currentLevelIdx >= levels.length) {
            // å…¨ç ´
            document.querySelector('.left-panel').style.display = 'none';
            document.querySelector('.right-panel').style.display = 'none';
            document.getElementById('end-screen').style.display = 'flex';
            launchConfetti();
        } else {
            loadLevel();
        }
    }

    function launchConfetti() {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#29b6f6', '#0288d1', '#ffffff']
        });
    }
</script>

</body>
</html>
