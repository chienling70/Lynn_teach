<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆèªç‰¹è¨“ï¼šå¿«é¾é€²åŒ–å¤§å†’éšª</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            font-family: "Noto Sans TC", "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #6dd5fa 0%, #2980b9 100%); /* è¿·ä½ é¾çš„è—è‰²ç³» */
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            color: #fff;
        }

        /* å·¦å´ï¼šå¯¶å¯å¤¢å±•ç¤ºå€ */
        .poke-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(0,0,0,0) 70%);
            position: relative;
        }

        .poke-container {
            width: 350px;
            height: 350px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .poke-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.5));
            transition: transform 0.3s;
            image-rendering: pixelated;
        }
        
        .poke-name {
            font-size: 36px;
            font-weight: bold;
            margin-top: 20px;
            text-shadow: 2px 2px 0 #000;
        }

        .poke-level {
            font-size: 20px;
            color: #f1c40f; /* å¿«é¾çš„é»ƒè‰² */
            margin-top: 5px;
            font-weight: bold;
            text-shadow: 1px 1px 0 #000;
        }

        /* ç¶“é©—æ¢ */
        .exp-bar-container {
            width: 80%;
            height: 24px;
            background: rgba(0,0,0,0.5);
            border-radius: 12px;
            margin-top: 25px;
            border: 2px solid #fff;
            overflow: hidden;
            position: relative;
        }
        
        .exp-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #f1c40f, #e67e22); /* é»ƒæ©˜è‰²æ¼¸å±¤ */
            transition: width 0.5s ease-out;
        }

        /* é€²åŒ–ç‰¹æ•ˆ */
        .evolving {
            animation: evolveFlash 2s infinite;
        }

        @keyframes evolveFlash {
            0% { filter: brightness(1) drop-shadow(0 0 10px white); transform: scale(1); }
            50% { filter: brightness(100) drop-shadow(0 0 50px white); transform: scale(1.1); }
            100% { filter: brightness(1) drop-shadow(0 0 10px white); transform: scale(1); }
        }

        /* å—å‚·ç‰¹æ•ˆ */
        .hurt { animation: hurtShake 0.5s; filter: grayscale(1) brightness(0.5); }
        @keyframes hurtShake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        /* å³å´ï¼šé¡Œç›®å€ */
        .quiz-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-left: 6px solid #f39c12;
            box-shadow: -10px 0 30px rgba(0,0,0,0.3);
        }

        .question-card {
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        .q-number { font-size: 18px; color: #7f8c8d; margin-bottom: 10px; font-weight: bold; }
        
        .q-text { 
            font-size: 26px; 
            font-weight: bold; 
            margin-bottom: 30px; 
            line-height: 1.5; 
            color: #2c3e50;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: white;
            border: 3px solid #3498db;
            color: #2980b9;
            font-size: 24px;
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: bold;
            box-shadow: 0 5px 0 #2980b9;
        }

        .option-btn:hover { background-color: #eaf2f8; transform: translateY(-3px); }
        .option-btn:active { transform: translateY(3px); box-shadow: none; }

        /* éŒ¯èª¤å›é¥‹ Modal */
        .modal {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            color: white;
            padding: 20px;
        }
        .modal h2 { font-size: 40px; color: #ff5252; margin-bottom: 20px; text-shadow: 2px 2px 0 #000; }
        .modal-content { font-size: 22px; margin-bottom: 30px; line-height: 1.6; max-width: 80%; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; }
        
        .next-btn {
            background: #f1c40f; color: #333; border: none;
            padding: 12px 40px; font-size: 22px; border-radius: 50px;
            cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #d4ac0d;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }

        /* æœ€çµ‚çµæœ */
        .review-area {
            display: none;
            margin-top: 20px;
            text-align: left;
            width: 100%;
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid #3498db;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 10px;
        }
        .review-item { font-size: 16px; border-bottom: 1px dashed #bdc3c7; padding: 10px 0; color: #333; }
        .review-wrong { color: #c0392b; text-decoration: line-through; margin-right: 5px; }
        .review-correct { color: #27ae60; font-weight: bold; }

        /* RWD */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .poke-section { min-height: 40vh; padding: 20px; }
            .quiz-section { min-height: 60vh; padding: 20px; border-left: none; border-top: 5px solid #f39c12; }
            .poke-container { width: 180px; height: 180px; }
            .poke-name { font-size: 28px; }
            .q-text { font-size: 20px; }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="poke-section">
        <div class="poke-container">
            <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/147.png" id="poke-img" class="poke-img">
        </div>
        <div class="poke-name" id="poke-name">è¿·ä½ é¾</div>
        <div class="poke-level" id="poke-status">åŠªåŠ›æˆé•·ä¸­...</div>
        
        <div class="exp-bar-container">
            <div class="exp-fill" id="exp-bar"></div>
        </div>
        <div style="margin-top:8px; font-size:14px; opacity:0.9;">é€²åŒ–èƒ½é‡</div>
    </div>

    <div class="quiz-section">
        <div class="question-card" id="quiz-card">
            <div class="q-number">ç¬¬ <span id="q-num">1</span> / 15 é¡Œ</div>
            <div style="color:#7f8c8d; font-size:16px; margin-bottom:5px;">è«‹çœ‹æ„æ€é¸æˆèªï¼š</div>
            <div class="q-text" id="q-text">é¡Œç›®è¼‰å…¥ä¸­...</div>
            <div class="options-grid" id="options-area"></div>
        </div>

        <div id="end-screen" style="display:none; text-align:center;">
            <h1 style="color:#e67e22; font-size: 36px;">å†’éšªçµæŸï¼</h1>
            <p style="font-size:22px; margin-bottom:20px;">ä½ çš„å¤¥ä¼´æœ€çµ‚é€²åŒ–æˆï¼š<br><span id="final-form" style="color:#f39c12; font-weight:bold; font-size:40px; text-shadow:1px 1px 0 #333;"></span></p>
            
            <button class="next-btn" style="background:#bdc3c7; margin-right:10px;" onclick="toggleReview()">æª¢è¦–éŒ¯é¡Œ</button>
            <button class="next-btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
            
            <div id="review-area" class="review-area"></div>
        </div>
    </div>

    <div class="modal" id="feedback-modal">
        <h2 id="fb-title">ğŸ˜¢ ç­”éŒ¯äº†ï¼</h2>
        <div class="modal-content" id="fb-content">
            æ­£ç¢ºç­”æ¡ˆæ˜¯...
        </div>
        <button class="next-btn" onclick="nextQuestion()">ç¹¼çºŒç‰¹è¨“</button>
    </div>

<script>
    // --- éŠæˆ²è³‡æ–™è¨­å®š ---
    
    // é€²åŒ–éšæ®µè¨­å®š (å¿«é¾è·¯ç·š)
    // 0åˆ†: è¿·ä½ é¾, 5åˆ†: å“ˆå…‹é¾, 10åˆ†: å¿«é¾, 15åˆ†: å¿«é¾(æ”»æ“Šç‹€æ…‹/æ…¶ç¥)
    const evolutionStages = [
        { minScore: 0, name: "è¿·ä½ é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/147.png" }, 
        { minScore: 5, name: "å“ˆå…‹é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/148.png" },
        { minScore: 10, name: "å¿«é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/149.png" },
        { minScore: 15, name: "å¿«é¾ (æœ€å¼·ç‹€æ…‹)", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/home/149.png" } // æ›å€‹å§¿å‹¢æˆ–åŸåœ–
    ];

    // 15é¡Œæˆèªèˆ‡æ„æ€
    const rawQuestions = [
        { idiom: "ä¸€è²§å¦‚æ´—", meaning: "å®¶è£¡éå¸¸çª®ï¼Œçª®åˆ°åƒè¢«æ°´æ´—éä¸€æ¨£ä¹¾æ·¨ï¼Œä»€éº¼å€¼éŒ¢çš„æ±è¥¿éƒ½æ²’æœ‰ã€‚" },
        { idiom: "åˆ»è‹¦è€å‹", meaning: "åšäº‹éå¸¸åŠªåŠ›ï¼Œå°±ç®—å·¥ä½œå†è¾›è‹¦ã€å†ç´¯ä¹Ÿä¸æ€•ï¼Œé¡˜æ„å …æŒä¸‹å»ã€‚" },
        { idiom: "æ¼¸å…¥ä½³å¢ƒ", meaning: "æƒ…æ³æ…¢æ…¢è®Šå¥½ï¼Œå°±åƒå€’åƒç”˜è”—ä¸€æ¨£è¶Šä¾†è¶Šç”œï¼Œæˆ–æ˜¯é¢¨æ™¯è¶Šä¾†è¶Šæ¼‚äº®ã€‚" },
        { idiom: "é½’é °ç•™é¦™", meaning: "æ±è¥¿å¤ªå¥½åƒäº†ï¼åƒå®Œä»¥å¾Œï¼Œå˜´å·´è£¡å¥½åƒé‚„ç•™è‘—é¦™å‘³ï¼Œè®“äººä¸€ç›´æƒ³å†åƒã€‚" },
        { idiom: "é™½å¥‰é™°é•", meaning: "è¡¨é¢ä¸Šç­”æ‡‰èªªã€Œå¥½ã€ï¼Œä½†ç§åº•ä¸‹å»å·å·ä¸ç…§åšï¼Œç”šè‡³åšç›¸åçš„äº‹ã€‚" },
        { idiom: "å“€é´»éé‡", meaning: "å½¢å®¹ç™¼ç”Ÿå¤§ç½é›£ï¼ˆåƒæˆ°çˆ­æˆ–åœ°éœ‡ï¼‰å¾Œï¼Œåˆ°è™•éƒ½æ˜¯å¤±å»å®¶åœ’ã€æ­£åœ¨å“­å–Šçš„å¯æ†äººã€‚" },
        { idiom: "è‡¥è–ªå˜—è†½", meaning: "ç‚ºäº†é”æˆç›®æ¨™ï¼Œæ•…æ„è®“è‡ªå·±åƒè‹¦ï¼ˆç¡åœ¨æŸ´è‰ä¸Šã€åƒè‹¦è†½ï¼‰ï¼Œä¾†æé†’è‡ªå·±è¦åŠªåŠ›ï¼Œä¸èƒ½å·æ‡¶ã€‚" },
        { idiom: "ç—›å®šæ€ç—›", meaning: "é›–ç„¶ç—›è‹¦çš„äº‹æƒ…å·²ç¶“éå»äº†ï¼Œä½†å›æƒ³èµ·ä¾†é‚„æ˜¯å¾ˆç—›å¿ƒï¼Œæ‰€ä»¥ä¸‹å®šæ±ºå¿ƒè¨˜å–æ•™è¨“ï¼Œä¸‹æ¬¡ä¸å†çŠ¯éŒ¯ã€‚" },
        { idiom: "æ±Ÿéƒæ‰ç›¡", meaning: "æœ¬ä¾†å¾ˆè°æ˜ã€å¾ˆæœƒå¯«æ–‡ç« ï¼Œä½†å¾Œä¾†è…¦è¢‹ç©ºç©ºï¼Œå†ä¹Ÿæƒ³ä¸å‡ºå¥½é»å­äº†ã€‚" },
        { idiom: "çœ¾æœ›æ‰€æ­¸", meaning: "å¤§å®¶éƒ½éå¸¸ä¿¡ä»»ä»–ã€å–œæ­¡ä»–ï¼Œå¸Œæœ›ç”±ä»–ä¾†ç•¶é ˜è¢–ï¼ˆåƒæ˜¯å¤§å®¶éƒ½æŠ•ç¥¨é¸ä»–ç•¶ç­é•·ï¼‰ã€‚" },
        { idiom: "é˜®å›Šç¾æ¾€", meaning: "å£è¢‹è£¡æ²’ä»€éº¼éŒ¢ï¼Œæƒ³è²·æ±è¥¿å»æ‹¿ä¸å‡ºéŒ¢ä¾†ï¼Œæ„Ÿè¦ºæœ‰é»ä¸å¥½æ„æ€ã€‚" },
        { idiom: "å·®å¼·äººæ„", meaning: "é›–ç„¶è¡¨ç¾å¾—ä¸æ˜¯æœ€å®Œç¾çš„ï¼Œä½†å¤§é«”ä¸Šé‚„ç®—å¯ä»¥æ¥å—ï¼Œå‹‰å¼·è®“äººæ»¿æ„ã€‚" },
        { idiom: "åˆå‡ºèŒ…å»¬", meaning: "å‰›å‰›é–‹å§‹å‡ºä¾†åšäº‹ï¼ˆåƒå‰›ç•¢æ¥­çš„å¤§å“¥å“¥å¤§å§Šå§Šï¼‰ï¼Œä»€éº¼ç¶“é©—éƒ½æ²’æœ‰çš„æ–°æ‰‹ã€‚" },
        { idiom: "ä¸Ÿä¸‰è½å››", meaning: "è¨˜æ€§ä¸å¥½æˆ–æ˜¯å¤ªç²—å¿ƒï¼Œå¸¸å¸¸å¿˜æ±å¿˜è¥¿ï¼Œä¸€ä¸‹å¿˜äº†å¸¶èª²æœ¬ï¼Œä¸€ä¸‹å¿˜äº†å¸¶æ°´å£ºã€‚" },
        { idiom: "ä½œè‚²è‹±æ‰", meaning: "å¾ˆç”¨å¿ƒåœ°æ•™å°å­¸ç”Ÿï¼ŒåŸ¹é¤Šå‡ºè¨±å¤šå„ªç§€ã€å²å®³çš„äººæ‰ï¼ˆé€šå¸¸ç”¨ä¾†æ„Ÿè¬è€å¸«ï¼‰ã€‚" }
    ];

    let quizList = [];
    let currentQ = 0;
    let score = 0;
    let currentStageIndex = 0;
    let wrongAnswers = [];
    const totalQuestions = 15;

    // --- éŠæˆ²é‚è¼¯ ---

    window.onload = function() {
        // åˆå§‹åŒ–åœ–ç‰‡
        document.getElementById('poke-img').src = evolutionStages[0].img;
        startQuiz();
    };

    function startQuiz() {
        // æ´—ç‰Œé¡Œç›®
        quizList = rawQuestions.map(item => {
            let correct = item.idiom;
            // éš¨æ©Ÿå–3å€‹éŒ¯èª¤é¸é …
            let distractors = rawQuestions
                .filter(x => x.idiom !== correct)
                .map(x => x.idiom)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            let options = [correct, ...distractors].sort(() => 0.5 - Math.random());
            
            return {
                question: item.meaning,
                ans: correct,
                options: options
            };
        }).sort(() => 0.5 - Math.random());

        currentQ = 0;
        score = 0;
        currentStageIndex = 0;
        wrongAnswers = [];
        updateUI();
        loadQuestion();
    }

    function loadQuestion() {
        if(currentQ >= quizList.length) {
            endGame();
            return;
        }

        const qData = quizList[currentQ];
        document.getElementById('q-num').innerText = (currentQ + 1);
        document.getElementById('q-text').innerText = qData.question;
        
        const optsArea = document.getElementById('options-area');
        optsArea.innerHTML = "";

        qData.options.forEach(opt => {
            let btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(opt);
            optsArea.appendChild(btn);
        });
        
        document.getElementById('feedback-modal').style.display = 'none';
    }

    function checkAnswer(userChoice) {
        const qData = quizList[currentQ];
        
        if (userChoice === qData.ans) {
            score++;
            // ç­”å°å‹•ç•«
            const pokeImg = document.getElementById('poke-img');
            pokeImg.style.transform = "scale(1.2) rotate(5deg)";
            setTimeout(() => pokeImg.style.transform = "scale(1) rotate(0deg)", 300);
            
            checkEvolution();
            setTimeout(nextQuestion, 500); 
        } else {
            // ç­”éŒ¯
            wrongAnswers.push({
                q: qData.question,
                user: userChoice,
                ans: qData.ans
            });
            
            // å—å‚·å‹•ç•«
            const pokeImg = document.getElementById('poke-img');
            pokeImg.classList.add('hurt');
            setTimeout(() => pokeImg.classList.remove('hurt'), 500);

            showFeedback(qData);
        }
        updateUI();
    }

    function checkEvolution() {
        let nextStage = currentStageIndex;
        // æª¢æŸ¥æ˜¯å¦é”åˆ°ä¸‹ä¸€éšæ®µé–€æª»
        for (let i = evolutionStages.length - 1; i >= 0; i--) {
            if (score >= evolutionStages[i].minScore) {
                nextStage = i;
                break;
            }
        }

        if (nextStage > currentStageIndex) {
            triggerEvolution(nextStage);
        }
    }

    function triggerEvolution(newStageIndex) {
        const pokeImg = document.getElementById('poke-img');
        const pokeName = document.getElementById('poke-name');
        
        // é€²åŒ–å‹•ç•«é–‹å§‹
        pokeImg.classList.add('evolving');
        
        setTimeout(() => {
            currentStageIndex = newStageIndex;
            const stageData = evolutionStages[currentStageIndex];
            
            // æ›åœ–
            pokeImg.src = stageData.img;
            pokeName.innerText = stageData.name;
            document.getElementById('poke-status').innerText = "é€²åŒ–æˆåŠŸï¼";
            document.getElementById('poke-status').style.color = "#2ecc71";

            // å‹•ç•«çµæŸ
            setTimeout(() => {
                pokeImg.classList.remove('evolving');
                document.getElementById('poke-status').style.color = "#f1c40f";
                document.getElementById('poke-status').innerText = "æˆ°é¬¥åŠ›å¤§å¹…ä¸Šå‡ï¼";
            }, 1000);
            
            // æ»¿åˆ†ç‰¹æ•ˆ
            if (newStageIndex === evolutionStages.length - 1) {
                launchConfetti();
            }

        }, 1500); 
    }

    function updateUI() {
        // æ›´æ–°ç¶“é©—æ¢ (15é¡Œæ»¿)
        const percentage = (score / totalQuestions) * 100;
        document.getElementById('exp-bar').style.width = percentage + "%";
    }

    function showFeedback(qData) {
        const modal = document.getElementById('feedback-modal');
        const content = document.getElementById('fb-content');
        
        content.innerHTML = `æ­£ç¢ºæˆèªæ˜¯ï¼š<br><span style="color:#f1c40f; font-size:32px; font-weight:bold;">${qData.ans}</span><br><br><span style="font-size:18px; color:#ddd;">${qData.question}</span>`;
        
        modal.style.display = 'flex';
    }

    function nextQuestion() {
        currentQ++;
        loadQuestion();
    }

    function endGame() {
        document.getElementById('quiz-card').style.display = 'none';
        const endScreen = document.getElementById('end-screen');
        endScreen.style.display = 'block';
        
        // å¦‚æœæ»¿åˆ†ï¼Œé¡¯ç¤ºæœ€å¾Œä¸€éšçš„åå­—ï¼›å¦å‰‡é¡¯ç¤ºç›®å‰éšæ®µ
        document.getElementById('final-form').innerText = evolutionStages[currentStageIndex].name;
        
        if (score === totalQuestions) {
            launchConfetti();
        }
        
        if (wrongAnswers.length > 0) {
            renderWrongAnswers();
        }
    }

    function renderWrongAnswers() {
        const area = document.getElementById('review-area');
        area.innerHTML = "";
        wrongAnswers.forEach((item, index) => {
            let div = document.createElement('div');
            div.className = 'review-item';
            div.innerHTML = `
                <div style="margin-bottom:5px;">${index+1}. ${item.q}</div>
                <div>ä½ çš„ç­”æ¡ˆï¼š<span class="review-wrong">${item.user}</span> æ­£è§£ï¼š<span class="review-correct">${item.ans}</span></div>
            `;
            area.appendChild(div);
        });
    }

    function toggleReview() {
        const area = document.getElementById('review-area');
        area.style.display = (area.style.display === 'block') ? 'none' : 'block';
    }

    function launchConfetti() {
        var duration = 3 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        function random(min, max) { return Math.random() * (max - min) + min; }
        var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(interval);
            var particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.1, 0.3), y: Math.random() - 0.2 } }));
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: random(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 250);
    }
</script>

</body>
</html>
