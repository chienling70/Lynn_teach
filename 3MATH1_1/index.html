<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èŠ±è““è““é€²åŒ–ï¼šåˆ†æ•¸å¤§æŒ‘æˆ°</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #FFFDE7; /* ç²‰ç´…è‰²èƒŒæ™¯ */
            background-image: 
                radial-gradient(#F06292 10%, transparent 10%),
                radial-gradient(#81C784 10%, transparent 10%);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
            user-select: none;
        }

        /* --- å·¦å´ï¼šå¯¶å¯å¤¢å±•ç¤ºå€ (ä½” 40%) --- */
        .left-panel {
            width: 40%;
            height: 100%;
            background: linear-gradient(160deg, #AED581 0%, #81C784 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 8px solid #FFF;
            position: relative;
            box-shadow: 5px 0 20px rgba(0,0,0,0.3);
            z-index: 2;
        }

        .poke-img-container {
            width: 80%;
            height: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.8);
            border: 6px solid #FFF;
        }

        .poke-img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.2));
            transition: transform 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .poke-info {
            text-align: center;
            color: #33691E;
            margin-top: 30px;
        }

        .poke-name {
            font-size: 42px;
            font-weight: 900;
            color: #FFF;
            text-shadow: 2px 2px 0 #558B2F;
            margin: 0;
        }

        .level-indicator {
            font-size: 20px;
            color: #558B2F;
            margin-top: 15px;
            background: #DCEDC8;
            padding: 6px 20px;
            border-radius: 30px;
            font-weight: bold;
            box-shadow: 0 4px 0 #8BC34A;
        }

        /* --- å³å´ï¼šéŠæˆ²å€ (ä½” 60%) --- */
        .right-panel {
            width: 60%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .game-header {
            padding: 20px 30px;
            background: #F06292;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #C2185B;
        }

        .header-title {
            font-size: 24px;
            font-weight: 900;
            letter-spacing: 1px;
        }

        .progress-text {
            font-size: 18px;
            background: rgba(255,255,255,0.3);
            padding: 5px 15px;
            border-radius: 12px;
            font-weight: bold;
        }

        /* éŠæˆ²ä¸»è¦å…§å®¹å€ */
        .game-content {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 20px;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            overflow-y: auto;
        }

        /* é¡Œç›®æ¡† */
        .question-box {
            background: #FFF;
            width: 95%;
            padding: 25px;
            border-radius: 20px;
            border: 4px solid #F8BBD0;
            box-shadow: 0 8px 0 #F48FB1;
            text-align: left;
            font-size: 22px;
            color: #880E4F;
            font-weight: bold;
            line-height: 1.8;
            position: relative;
            animation: fadeIn 0.5s;
        }

        /* åˆ†æ•¸æ¨£å¼ */
        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 2px;
            font-size: 0.9em;
        }
        .fraction sup {
            display: block;
            border-bottom: 2px solid #880E4F;
            padding: 0 2px;
            font-size: 0.8em;
        }
        .fraction sub {
            display: block;
            font-size: 0.8em;
        }

        /* é¸é …æŒ‰éˆ•å€ */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 95%;
        }

        .option-btn {
            background: white;
            border: 3px solid #81C784;
            color: #33691E;
            font-size: 20px;
            padding: 15px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.1s;
            font-weight: bold;
            box-shadow: 0 5px 0 #558B2F;
            font-family: "Noto Sans TC", sans-serif;
            text-align: left;
            display: flex;
            align-items: center;
        }

        .option-btn:hover {
            background-color: #F1F8E9;
            transform: translateY(-2px);
        }

        .option-btn:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        /* éŒ¯èª¤æç¤º Modal (åªé¡¯ç¤ºè§£æ) */
        .feedback-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .feedback-content {
            background: white;
            width: 85%;
            max-width: 600px;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            border-top: 10px solid #E91E63;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }
        .feedback-title { color: #C2185B; font-size: 32px; margin-bottom: 20px; font-weight: 900; }
        .feedback-msg { 
            font-size: 20px; 
            color: #333; 
            line-height: 1.6; 
            margin-bottom: 30px; 
            background: #FCE4EC; 
            padding: 20px; 
            border-radius: 15px; 
            text-align: left;
            border-left: 5px solid #E91E63;
        }
        .feedback-btn {
            background: #E91E63; color: white; border: none; padding: 12px 40px;
            font-size: 22px; border-radius: 50px; cursor: pointer; font-weight:bold;
            box-shadow: 0 5px 0 #C2185B;
        }
        .feedback-btn:active { transform: translateY(4px); box-shadow: none; }

        /* éŒ¯é¡Œå›é¡§é é¢ */
        .review-screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }
        .review-card {
            background: white;
            width: 90%;
            max-width: 800px;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 15px;
            border-left: 8px solid #FF7043;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .review-q { font-weight: bold; font-size: 18px; color: #333; margin-bottom: 10px; }
        .review-ans { color: #388E3C; font-weight: bold; margin-bottom: 5px; }
        .review-exp { font-size: 16px; color: #555; background: #FFF3E0; padding: 10px; border-radius: 8px; }

        /* å‹•ç•« */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* RWD */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .left-panel { width: 100%; height: 35vh; border-right: none; border-bottom: 6px solid #FFF; }
            .right-panel { width: 100%; height: 65vh; }
            .poke-name { font-size: 32px; }
            .game-content { padding: 15px; }
            .question-box { font-size: 18px; padding: 15px; }
            .options-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="left-panel" id="left-panel">
        <div class="poke-img-container">
            <img src="" id="poke-img" class="poke-img">
        </div>
        <div class="poke-info">
            <h1 class="poke-name" id="poke-name">èŠ±è““è““</h1>
            <div class="level-indicator" id="stage-indicator">éšæ®µä¸€ï¼šèŠ±æµ·æ¢éšª</div>
        </div>
    </div>

    <div class="right-panel">
        <div class="game-header">
            <div class="header-title">åˆ†æ•¸å¤§æŒ‘æˆ°</div>
            <div class="progress-text" id="progress-text">ç¬¬ 1 / 15 é¡Œ</div>
        </div>

        <div class="game-content" id="game-area">
            <div class="question-box" id="question-text">
                é¡Œç›®è¼‰å…¥ä¸­...
            </div>
            <div class="options-grid" id="options-grid">
                </div>
        </div>

        <div class="review-screen" id="review-area">
            <h2 style="color: #E91E63; font-size: 30px;">ğŸŒ¸ éŒ¯é¡Œå›é¡§èŠ±åœ’ ğŸŒ¸</h2>
            <div id="review-list" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>
            <button class="feedback-btn" onclick="location.reload()" style="margin: 30px;">å†æŒ‘æˆ°ä¸€æ¬¡</button>
        </div>
    </div>

    <div class="feedback-modal" id="feedback-modal">
        <div class="feedback-content">
            <div class="feedback-title">ğŸ¥€ å“å‘€ï¼Œç­”éŒ¯äº†ï¼</div>
            <div class="feedback-msg" id="feedback-text"></div>
            <button class="feedback-btn" onclick="closeModal()">å†è©¦ä¸€æ¬¡</button>
        </div>
    </div>

<script>
    // --- è³‡æ–™è™•ç†èˆ‡è¼”åŠ©å‡½å¼ ---
    
    // å°‡ \F(a,b) è½‰æ›ç‚º HTML åˆ†æ•¸æ ¼å¼
    function formatText(text) {
        return text.replace(/\\F\((\d+|â–¡|[\d\+\-\s]+),(\d+|â– |[\d\+\-\s]+)\)/g, function(match, n, d) {
            return `<span class="fraction"><sup>${n}</sup><sub>${d}</sub></span>`;
        });
    }

    // --- é¡Œç›®è³‡æ–™åº« (å·²è£œä¸Šè§£æ) ---
    const rawQuestions = [
        {
            q: "ä¸€å€‹è›‹ç³•å¹³åˆ†æˆ8å¡Šï¼Œå°å‰å’Œ6å€‹åŒå­¸ä¸€å€‹äººåƒ1å¡Šï¼Œä¸€å…±åƒäº†å¤šå°‘å€‹è›‹ç³•ï¼Ÿ",
            options: ["\\F(6,8å€‹", "\\F(8,6å€‹", "\\F(7,8å€‹", "\\F(8,7å€‹"],
            ansIndex: 2, // 3 -> index 2
            exp: "å°å‰ + 6å€‹åŒå­¸ = 7å€‹äººã€‚<br>æ¯äººåƒ1å¡Šï¼Œå…±åƒäº†7å¡Šã€‚<br>æ¯å€‹è›‹ç³•åˆ‡æˆ8å¡Šï¼Œæ‰€ä»¥åƒäº† \\F(7,8 å€‹è›‹ç³•ã€‚"
        },
        {
            q: "ä¸‹é¢å“ªä¸€å€‹é¸é …ä¸­çš„ç®—å¼ç­”æ¡ˆæœ€å¤§ï¼Ÿ",
            options: ["\\F(3,10ï¼‹\\F(6,10", "\\F(5,10ï¼‹\\F(2,10", "\\F(4,10ï¼‹\\F(4,10", "\\F(6,10ï¼‹\\F(4,10"],
            ansIndex: 3, // 4 -> index 3
            exp: "â‘  \\F(9,10<br>â‘¡ \\F(7,10<br>â‘¢ \\F(8,10<br>â‘£ \\F(10,10 = 1 (æœ€å¤§)"
        },
        {
            q: "ä¸‹é¢å“ªä¸€å€‹é¸é …ä¸­çš„ç®—å¼ç­”æ¡ˆæœ€å°ï¼Ÿ",
            options: ["\\F(5,9ï¼‹\\F(4,9", "\\F(4,9ï¼‹\\F(3,9", "\\F(6,9ï¼‹\\F(2,9", "\\F(7,9ï¼‹\\F(1,9"],
            ansIndex: 1, // 2 -> index 1
            exp: "â‘  \\F(9,9<br>â‘¡ \\F(7,9 (æœ€å°)<br>â‘¢ \\F(8,9<br>â‘£ \\F(8,9"
        },
        {
            q: "ä¸‹é¢å“ªä¸€å€‹é¸é …ä¸­çš„ç®—å¼ç­”æ¡ˆæœ€å°ï¼Ÿ",
            options: ["\\F(5,8ï¼‹\\F(3,8", "\\F(4,7ï¼‹\\F(3,7", "\\F(4,9ï¼‹\\F(3,9", "\\F(7,9ï¼‹\\F(2,9"],
            ansIndex: 2, // 3 -> index 2
            exp: "â‘  \\F(8,8=1<br>â‘¡ \\F(7,7=1<br>â‘¢ \\F(7,9 (å°æ–¼1ï¼Œæœ€å°)<br>â‘£ \\F(9,9=1"
        },
        {
            q: "ä¸‹é¢å“ªä¸€å€‹é¸é …ä¸­çš„ç®—å¼ç­”æ¡ˆå’Œ2å€‹\\F(1,2ä¸€æ¨£å¤§ï¼Ÿ",
            options: ["\\F(5,7ï¼‹\\F(2,7", "\\F(2,5ï¼‹\\F(1,5", "\\F(1,3ï¼‹\\F(1,3", "\\F(2,6ï¼‹\\F(3,6"],
            ansIndex: 0, // 1 -> index 0
            exp: "2å€‹ \\F(1,2 æ˜¯ \\F(2,2 = 1ã€‚<br>â‘  \\F(7,7 = 1 (ä¸€æ¨£å¤§)<br>â‘¡ \\F(3,5<br>â‘¢ \\F(2,3<br>â‘£ \\F(5,6"
        },
        {
            q: "æœ‰ä¸€æ¢é•·\\F(7,7å…¬å°ºçš„ç¹©å­ï¼Œå’Œä¸€æ¢é•·\\F(5,5å…¬å°ºçš„ç¹©å­ï¼Œå…©æ¢ç¹©å­åˆèµ·ä¾†å…±é•·å¤šå°‘å…¬å°ºï¼Ÿ",
            options: ["1å…¬å°º", "2å…¬å°º", "\\F(2,7å…¬å°º", "ç„¡æ³•è¨ˆç®—"],
            ansIndex: 1, // 2 -> index 1
            exp: "\\F(7,7å…¬å°º = 1å…¬å°ºã€‚<br>\\F(5,5å…¬å°º = 1å…¬å°ºã€‚<br>1 + 1 = 2å…¬å°ºã€‚"
        },
        {
            q: "ç¾ç¾å¯«æ•¸å­¸è€ƒå·ï¼Œä¸å°å¿ƒå°‡é¡Œç›®çš„è¢«æ¸›æ•¸å¼„é«’ï¼Œè€ƒå·ä¸Šæ¸›æ•¸æ˜¯\\F(1,4ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯\\F(3,4ï¼ŒåŸæœ¬é¡Œç›®çš„è¢«æ¸›æ•¸æ˜¯å¤šå°‘ï¼Ÿ",
            options: ["1", "\\F(1,4", "\\F(2,4", "\\F(3,4"],
            ansIndex: 0, // 1 -> index 0
            exp: "è¢«æ¸›æ•¸ ï¼ æ¸›æ•¸ ï¼ å·®ã€‚<br>æ‰€ä»¥ï¼Œè¢«æ¸›æ•¸ ï¼ å·® ï¼‹ æ¸›æ•¸ã€‚<br>\\F(3,4 ï¼‹ \\F(1,4 ï¼ \\F(4,4 ï¼ 1ã€‚"
        },
        {
            q: "é¡Œç›®ï¼š\\F(2,6ï¼‹\\F(1,6ï¼(ã€€ã€€)<br>è¨ˆç®—éç¨‹ï¼š\\F(2,6ï¼‹\\F(1,6ï¼\\F(2ï¼‹1,6ï¼‹6ï¼\\F(3,12<br>ä¸Šé¢æ˜¯ç¾ç¾å¯«æ•¸å­¸é¡Œç›®çš„è¨ˆç®—éç¨‹ï¼Œå¥¹çš„è¨ˆç®—éç¨‹æ­£ç¢ºå—ï¼Ÿ",
            options: ["æ­£ç¢º", "éŒ¯èª¤ï¼Œè¨ˆç®—éç¨‹æ˜¯\\F(2,6ï¼‹\\F(1,6ï¼\\F(2,6ï¼‹6ï¼\\F(2,12", "éŒ¯èª¤ï¼Œè¨ˆç®—éç¨‹æ˜¯\\F(2,6ï¼‹\\F(1,6ï¼\\F(2ï¼‹1,6ï¼\\F(3,6", "éŒ¯èª¤ï¼Œè¨ˆç®—éç¨‹æ˜¯\\F(2,6ï¼‹\\F(1,6ï¼\\F(1,6ï¼‹6ï¼\\F(1,12"],
            ansIndex: 2, // 3 -> index 2
            exp: "åˆ†æ•¸ç›¸åŠ æ™‚ï¼Œåˆ†æ¯ä¸è®Šï¼Œåˆ†å­ç›¸åŠ ã€‚<br>æ­£ç¢ºæ‡‰ç‚ºï¼š\\F(2ï¼‹1,6 ï¼ \\F(3,6ã€‚"
        },
        {
            q: "ç¾ç¾å°‡ç«¹ç«¿ç›´ç«‹çš„æ’åˆ°æ°´åº•ï¼Œæœ‰\\F(3,15çš„ç«¹ç«¿åœ¨æ°´ä¸­ï¼Œå†å°‡ç«¹ç«¿åéä¾†ç›´ç«‹çš„æ’åˆ°æ°´åº•å¾Œï¼Œç«¹ç«¿ç¾åœ¨å…±æœ‰å¤šå°‘éƒ¨åˆ†æ˜¯æ¿•çš„ï¼Ÿ",
            options: ["\\F(6,15", "\\F(3,15", "\\F(9,15", "\\F(6,30"],
            ansIndex: 0, // 1 -> index 0
            exp: "ç¬¬ä¸€æ¬¡æ¿•äº† \\F(3,15ã€‚<br>åéä¾†æ’ï¼Œå¦ä¸€é ­ä¹Ÿæ¿•äº† \\F(3,15ã€‚<br>å…±æ¿•äº†ï¼š\\F(3,15 ï¼‹ \\F(3,15 ï¼ \\F(6,15ã€‚"
        },
        {
            q: "\\F(2,9ï¼‹\\F(â–¡,9ï¼\\F(3,9ï¼Œâ–¡è¡¨ç¤ºçš„æ•¸å­—æ˜¯å¤šå°‘ï¼Ÿ",
            options: ["1", "2", "3", "9"],
            ansIndex: 0, // 1 -> index 0
            exp: "åˆ†å­ç›¸åŠ ï¼š2 ï¼‹ â–¡ ï¼ 3ã€‚<br>æ‰€ä»¥ â–¡ ï¼ 1ã€‚"
        },
        {
            q: "\\F(â–¡,5ï¼‹\\F(â–¡,5ï¼\\F(4,5ï¼Œâ–¡æ˜¯ä¸€æ¨£çš„æ•¸ï¼Œâ–¡æ˜¯å¤šå°‘ï¼Ÿ",
            options: ["1", "2", "3", "4"],
            ansIndex: 1, // 2 -> index 1
            exp: "åˆ†å­ç›¸åŠ ï¼šâ–¡ ï¼‹ â–¡ ï¼ 4ã€‚<br>2 ï¼‹ 2 ï¼ 4ï¼Œæ‰€ä»¥ â–¡ æ˜¯ 2ã€‚"
        },
        {
            q: "\\F(â–¡,6ï¼‹\\F(â–¡,6ï¼1ï¼Œâ–¡æ˜¯ä¸€æ¨£çš„æ•¸ï¼Œâ–¡æ˜¯å¤šå°‘ï¼Ÿ",
            options: ["6", "3", "2", "1"],
            ansIndex: 1, // 2 -> index 1
            exp: "1 ç­‰æ–¼ \\F(6,6ã€‚<br>åˆ†å­ç›¸åŠ ï¼šâ–¡ ï¼‹ â–¡ ï¼ 6ã€‚<br>3 ï¼‹ 3 ï¼ 6ï¼Œæ‰€ä»¥ â–¡ æ˜¯ 3ã€‚"
        },
        {
            q: "\\F(â–¡,7ï¼‹\\F(4,7ï¼1ï¼Œâ–¡è¡¨ç¤ºçš„æ•¸å­—æ˜¯å¤šå°‘ï¼Ÿ",
            options: ["1", "3", "4", "7"],
            ansIndex: 1, // 2 -> index 1
            exp: "1 ç­‰æ–¼ \\F(7,7ã€‚<br>åˆ†å­ç›¸åŠ ï¼šâ–¡ ï¼‹ 4 ï¼ 7ã€‚<br>æ‰€ä»¥ â–¡ ï¼ 3ã€‚"
        },
        {
            q: "ä¸‹é¢å“ªä¸€å€‹é¸é …çš„ç­”æ¡ˆæ˜¯1ï¼Ÿ",
            options: ["\\F(1,5ï¼‹3å€‹\\F(1,5", "9å€‹ä¹åˆ†ä¹‹ä¸€", "\\F(2,7ï¼‹\\F(4,7", "\\F(3,6ï¼‹å…­åˆ†ä¹‹äºŒ"],
            ansIndex: 1, // 2 -> index 1
            exp: "â‘  \\F(1,5 + \\F(3,5 = \\F(4,5<br>â‘¡ 9å€‹ \\F(1,9 = \\F(9,9 = 1 (æ­£ç¢º)<br>â‘¢ \\F(6,7<br>â‘£ \\F(3,6 + \\F(2,6 = \\F(5,6"
        },
        {
            q: "å“¥å“¥åƒäº†\\F(2,6åŒ…è›‹å·ï¼Œè›‹å·é‚„å‰©ä¸‹\\F(4,6åŒ…ï¼ŒåŸæœ¬æœ‰å¤šå°‘åŒ…è›‹å·ï¼Ÿ",
            options: ["1åŒ…", "\\F(2,6åŒ…", "\\F(3,6åŒ…", "\\F(4,6åŒ…"],
            ansIndex: 0, // 1 -> index 0
            exp: "åƒæ‰çš„ ï¼‹ å‰©ä¸‹çš„ ï¼ åŸæœ¬çš„ã€‚<br>\\F(2,6 ï¼‹ \\F(4,6 ï¼ \\F(6,6 ï¼ 1 (åŒ…)ã€‚"
        }
    ];

    // éŠæˆ²ç‹€æ…‹è®Šæ•¸
    let currentQuestions = [];
    let currentIndex = 0;
    let wrongQuestionsLog = []; // è¨˜éŒ„ç¬¬ä¸€æ¬¡ç­”éŒ¯çš„é¡Œç›® {q, options, ansIndex, exp}
    let hasErrorInCurrentQuestion = false; // æ¨™è¨˜ç•¶å‰é¡Œç›®æ˜¯å¦ç­”éŒ¯é

    // é€²åŒ–è¨­å®š
    const stages = [
        { name: "èŠ±è““è““", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/669.png", title: "éšæ®µä¸€ï¼šç¨®å­èŒèŠ½" },
        { name: "èŠ±è‘‰è’‚", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/670.png", title: "éšæ®µäºŒï¼šèŠ±æœµç››é–‹" },
        { name: "èŠ±æ½”å¤«äºº", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/671.png", title: "éšæ®µä¸‰ï¼šèŠ±åœ’å®ˆè­·è€…" }
    ];

    window.onload = function() {
        startGame();
    };

    function startGame() {
        // æ´—ç‰Œ
        currentQuestions = [...rawQuestions].sort(() => 0.5 - Math.random());
        currentIndex = 0;
        wrongQuestionsLog = [];
        hasErrorInCurrentQuestion = false;
        
        document.getElementById('game-area').style.display = 'flex';
        document.getElementById('review-area').style.display = 'none';
        
        updatePokemon(0);
        loadQuestion();
    }

    function updatePokemon(stageIndex) {
        const data = stages[stageIndex];
        document.getElementById('poke-name').innerText = data.name;
        document.getElementById('stage-indicator').innerText = data.title;
        document.getElementById('poke-img').src = data.img;
        
        // é€²åŒ–å‹•ç•«
        if (stageIndex > 0) {
            const img = document.getElementById('poke-img');
            img.style.filter = "brightness(100) drop-shadow(0 0 20px white)";
            img.style.transform = "scale(1.2)";
            setTimeout(() => {
                img.style.filter = "drop-shadow(0 10px 15px rgba(0,0,0,0.2))";
                img.style.transform = "scale(1)";
                launchConfetti();
            }, 600);
        }
    }

    function loadQuestion() {
        // æ›´æ–°é€²åº¦èˆ‡é€²åŒ–ç‹€æ…‹
        // 0-4é¡Œ: èŠ±è““è““, 5-9é¡Œ: èŠ±è‘‰è’‚, 10-14é¡Œ: èŠ±æ½”å¤«äºº
        let stage = 0;
        if (currentIndex >= 5) stage = 1;
        if (currentIndex >= 10) stage = 2;
        
        // å¦‚æœå‰›è·¨å…¥æ–°éšæ®µï¼Œæ›´æ–°å¯¶å¯å¤¢
        const prevStage = currentIndex > 0 ? (currentIndex === 5 ? 0 : (currentIndex === 10 ? 1 : -1)) : -1;
        if ((currentIndex === 5 || currentIndex === 10) && !hasErrorInCurrentQuestion) {
            updatePokemon(stage);
        } else if (currentIndex === 0) {
            updatePokemon(0);
        }

        document.getElementById('progress-text').innerText = `ç¬¬ ${currentIndex + 1} / 15 é¡Œ`;

        const qData = currentQuestions[currentIndex];
        
        // æ¸²æŸ“é¡Œç›®
        document.getElementById('question-text').innerHTML = formatText(qData.q);
        
        // æ¸²æŸ“é¸é …
        const grid = document.getElementById('options-grid');
        grid.innerHTML = "";
        
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerHTML = formatText(opt);
            btn.onclick = () => checkAnswer(idx, btn);
            grid.appendChild(btn);
        });

        // é‡ç½®ç•¶å‰é¡Œç›®çš„éŒ¯èª¤ç‹€æ…‹æ¨™è¨˜ (å¦‚æœæ˜¯æ–°çš„ä¸€é¡Œ)
        // æ³¨æ„ï¼šé€™è£¡é‚è¼¯æ˜¯ã€Œåªè¦é€™é¡Œæ²’ç­”å°å‰éƒ½ç®—åŒä¸€é¡Œã€
    }

    function checkAnswer(selectedIndex, btn) {
        const qData = currentQuestions[currentIndex];
        
        if (selectedIndex === qData.ansIndex) {
            // ç­”å°äº†
            // è¦–è¦ºå›é¥‹
            btn.style.backgroundColor = "#A5D6A7";
            btn.style.border = "3px solid #388E3C";
            
            setTimeout(() => {
                // é‡ç½®æ¨™è¨˜ï¼Œæº–å‚™ä¸‹ä¸€é¡Œ
                hasErrorInCurrentQuestion = false;
                currentIndex++;
                
                if (currentIndex >= currentQuestions.length) {
                    showReviewScreen();
                } else {
                    loadQuestion();
                }
            }, 600);
        } else {
            // ç­”éŒ¯äº†
            // 1. å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡éŒ¯ï¼ŒåŠ å…¥éŒ¯é¡Œæœ¬
            if (!hasErrorInCurrentQuestion) {
                wrongQuestionsLog.push(qData);
                hasErrorInCurrentQuestion = true;
            }
            
            // 2. é¡¯ç¤ºè§£æè¦–çª— (ä¸é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆï¼Œåªçµ¦æç¤º)
            showErrorModal(qData.exp);
        }
    }

    function showErrorModal(expText) {
        const modal = document.getElementById('feedback-modal');
        const text = document.getElementById('feedback-text');
        
        text.innerHTML = `
            <strong>è§£ææç¤ºï¼š</strong><br>
            ${formatText(expText)}
        `;
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('feedback-modal').style.display = 'none';
    }

    function showReviewScreen() {
        document.getElementById('left-panel').style.display = 'none';
        document.getElementById('game-area').style.display = 'none';
        document.getElementById('progress-text').innerText = "ç‰¹è¨“å®Œæˆ";
        
        const reviewArea = document.getElementById('review-area');
        const reviewList = document.getElementById('review-list');
        reviewArea.style.display = 'flex';
        reviewList.innerHTML = "";

        if (wrongQuestionsLog.length === 0) {
            reviewList.innerHTML = "<h3 style='color:#388E3C;'>å¤ªæ£’äº†ï¼å…¨å°ï¼æ²’æœ‰éŒ¯é¡Œéœ€è¦è¤‡ç¿’ã€‚</h3>";
            launchConfetti();
        } else {
            reviewList.innerHTML = `<p>ä½ åœ¨é€™æ¬¡ç‰¹è¨“ä¸­ï¼Œå…±æœ‰ ${wrongQuestionsLog.length} é¡Œéœ€è¦åŠ å¼·ï¼š</p>`;
            
            wrongQuestionsLog.forEach((qData, index) => {
                const card = document.createElement('div');
                card.className = 'review-card';
                card.innerHTML = `
                    <div class="review-q">é¡Œç›® ${index + 1}ï¼š${formatText(qData.q)}</div>
                    <div class="review-ans">æ­£ç¢ºç­”æ¡ˆï¼š${formatText(qData.options[qData.ansIndex])}</div>
                    <div class="review-exp"><strong>è§£æï¼š</strong><br>${formatText(qData.exp)}</div>
                `;
                reviewList.appendChild(card);
            });
        }
        
        launchConfetti();
    }

    function launchConfetti() {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#F06292', '#81C784', '#FFF176']
        });
    }
</script>

</body>
</html>
