<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç«é¾é€²åŒ–ï¼šåš´æ ¼ç‰¹è¨“ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #2c3e50;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
            user-select: none;
        }

        /* --- å·¦å´ï¼šå¯¶å¯å¤¢å±•ç¤ºå€ (ä½” 40%) --- */
        .left-panel {
            width: 40%;
            height: 100%;
            background: linear-gradient(135deg, #1e272e 0%, #353b48 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-right: 5px solid #d35400;
            position: relative;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5);
            z-index: 2;
        }

        .poke-img-container {
            width: 90%;
            height: 60%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .poke-img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(255, 165, 0, 0.6));
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .poke-info {
            text-align: center;
            color: #fff;
            margin-top: 20px;
        }

        .poke-name {
            font-size: 40px;
            font-weight: 900;
            color: #f39c12;
            text-shadow: 2px 2px 0 #000;
            margin: 0;
        }

        .level-indicator {
            font-size: 20px;
            color: #bdc3c7;
            margin-top: 10px;
            background: rgba(0,0,0,0.5);
            padding: 5px 15px;
            border-radius: 20px;
        }

        /* --- å³å´ï¼šéŠæˆ²å€ (ä½” 60%) --- */
        .right-panel {
            width: 60%;
            height: 100%;
            background-color: #ecf0f1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .game-header {
            padding: 20px;
            background: #e67e22;
            color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-char {
            font-size: 32px;
            font-weight: bold;
        }

        .instruction {
            font-size: 16px;
            opacity: 0.9;
        }

        /* éŠæˆ²æ²å‹•å€ */
        .game-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* é¡Œç›®å®¹å™¨ (è§£é‡‹æ¡†) */
        .targets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .target-box {
            background: #fff;
            border: 3px solid #bdc3c7;
            border-radius: 15px;
            padding: 20px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: relative;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #95a5a6;
        }

        /* é¡Œç›®æ–‡å­— (è§£é‡‹) */
        .target-def {
            font-size: 18px;
            color: #2c3e50;
            line-height: 1.6;
            pointer-events: none;
        }

        /* ç­”å°æ¨£å¼ */
        .target-box.correct {
            border-color: #27ae60;
            background-color: #eafaf1;
            box-shadow: 0 0 0 2px #27ae60;
        }

        /* ç­”éŒ¯æ¨£å¼ (ç¬é–“) */
        .target-box.wrong-flash {
            animation: shake 0.5s;
            border-color: #c0392b;
            background-color: #fadbd8;
        }

        /* å¡«å…¥å¾Œçš„èªè©é¡¯ç¤º */
        .filled-word {
            margin-top: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            background-color: #27ae60;
            padding: 5px 20px;
            border-radius: 50px;
            animation: popIn 0.3s;
        }

        /* é¸é …å€ (èªè©) */
        .options-area {
            background: rgba(230, 126, 34, 0.1);
            border: 2px dashed #d35400;
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            min-height: 100px;
        }

        .draggable-item {
            background: #fff;
            color: #d35400;
            border: 2px solid #d35400;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 22px;
            font-weight: bold;
            cursor: grab;
            box-shadow: 0 4px 0 #a04000;
            transition: transform 0.1s;
            touch-action: none;
            z-index: 100;
        }

        .draggable-item:active {
            cursor: grabbing;
            transform: scale(1.1);
            background: #ffecb3;
        }

        /* æŒ‰éˆ• */
        .next-btn {
            margin: 0 auto;
            padding: 15px 60px;
            font-size: 24px;
            background: #2980b9;
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #1a5276;
            display: none;
            animation: pulseBtn 1.5s infinite;
        }

        /* éŒ¯èª¤æç¤º Modal */
        .error-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .error-content {
            background: white;
            width: 80%;
            max-width: 500px;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border-top: 10px solid #e74c3c;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .error-title { color: #e74c3c; font-size: 32px; margin-bottom: 20px; font-weight: bold; }
        .error-msg { font-size: 20px; color: #333; line-height: 1.6; margin-bottom: 30px; text-align: left; background:#f9f9f9; padding:15px; border-radius:10px;}
        .error-btn {
            background: #e74c3c; color: white; border: none; padding: 15px 40px;
            font-size: 22px; border-radius: 50px; cursor: pointer; font-weight:bold;
            box-shadow: 0 4px 0 #c0392b;
        }
        .error-btn:active { transform: translateY(4px); box-shadow: none; }

        /* çµæŸç•«é¢ */
        .end-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 3000; color: white;
        }

        /* å‹•ç•« */
        @keyframes popIn { 0% { transform: scale(0); } 80% { transform: scale(1.2); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        @keyframes evolveFlash { 
            0% { filter: brightness(1) drop-shadow(0 0 10px orange); } 
            50% { filter: brightness(100) drop-shadow(0 0 50px white); } 
            100% { filter: brightness(1) drop-shadow(0 0 10px orange); } 
        }
        @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* RWD èª¿æ•´ */
        @media (max-width: 768px) {
            body { flex-direction: column; overflow: auto; }
            .left-panel { width: 100%; height: 35vh; border-right: none; border-bottom: 5px solid #d35400; }
            .right-panel { width: 100%; height: 65vh; }
            .poke-name { font-size: 28px; }
            .game-header { padding: 10px; }
            .current-char { font-size: 24px; }
            .targets-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div class="left-panel">
        <div class="poke-img-container">
            <img src="" id="poke-img" class="poke-img">
        </div>
        <div class="poke-info">
            <h1 class="poke-name" id="poke-name">å°ç«é¾</h1>
            <div class="level-indicator" id="stage-indicator">ç¬¬ 1 / 8 é—œ</div>
        </div>
    </div>

    <div class="right-panel">
        <div class="game-header">
            <div class="current-char" id="level-header">ç¬¬ä¸€é—œï¼šæ…¶</div>
            <div class="instruction">å°‡èªè©æ‹–æ‹‰è‡³æ­£ç¢ºè§£é‡‹ (å…¨å°æ‰å¯é€šé—œ)</div>
        </div>

        <div class="game-content">
            <div class="targets-grid" id="targets-grid">
                </div>

            <div class="options-area" id="options-area">
                </div>

            <button class="next-btn" id="next-btn" onclick="nextLevel()">é€²åŒ–ï¼ä¸‹ä¸€é—œ</button>
        </div>
    </div>

    <div class="error-modal" id="error-modal">
        <div class="error-content">
            <div class="error-title">ğŸ’¥ æŒ‘æˆ°å¤±æ•—ï¼</div>
            <div class="error-msg" id="error-msg-text"></div>
            <button class="error-btn" onclick="resetLevel()">é‡æ–°æŒ‘æˆ°æœ¬é—œ</button>
        </div>
    </div>

    <div class="end-screen" id="end-screen">
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/10034.png" style="width:300px; filter: drop-shadow(0 0 20px #00bfff);">
        <h1 style="color:#f1c40f; font-size:40px; margin-top:20px;">ç‰¹è¨“å®Œå…¨åˆ¶éœ¸ï¼</h1>
        <h2>è¶…ç´šå™´ç«é¾ X è¦ºé†’ï¼</h2>
        <button class="next-btn" style="display:block; background:#fff; color:#333; margin-top:30px;" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
    </div>

<script>
    // --- éŠæˆ²è³‡æ–™åº« ---
    const levels = [
        {
            char: "æ…¶",
            pairs: [
                { word: "æ…¶è³€", def: "å‘åˆ¥äººèªªæ­å–œï¼Œæ›¿å°æ–¹æ„Ÿåˆ°é–‹å¿ƒã€‚" },
                { word: "å–œæ…¶", def: "å€¼å¾—é«˜èˆˆå’Œæ…¶ç¥çš„äº‹æƒ…ï¼ˆé€šå¸¸æŒ‡éå¹´æˆ–çµå©šï¼‰ã€‚" },
                { word: "æ…¶å…¸", def: "å¾ˆéš†é‡ã€å¾ˆç››å¤§çš„æ…¶ç¥æ´»å‹•ï¼ˆä¾‹å¦‚ï¼šåœ‹æ…¶æ—¥çš„éŠè¡Œï¼‰ã€‚" },
                { word: "æ…¶å¹¸", def: "è¦ºå¾—é‹æ°£å¾ˆå¥½ï¼Œé‚„å¥½æ²’æœ‰ç™¼ç”Ÿå£äº‹æƒ…ã€‚" }
            ]
        },
        {
            char: "æ‡·",
            pairs: [
                { word: "æ‡·å¿µ", def: "æƒ³å¿µä»¥å‰ç™¼ç”Ÿéçš„äº‹ï¼Œæˆ–æ˜¯ä¸åœ¨èº«é‚Šçš„äººã€‚" },
                { word: "æ‡·æŠ±", def: "ç”¨æ‰‹æŠŠæ±è¥¿æˆ–äººæŠ±åœ¨èƒ¸å‰ã€‚" },
                { word: "æ‡·ç–‘", def: "å¿ƒè£¡ä¸ç›¸ä¿¡ï¼Œè¦ºå¾—é‚£æ˜¯å‡çš„æˆ–æ˜¯éŒ¯çš„ã€‚" },
                { word: "é—œæ‡·", def: "é—œå¿ƒåˆ¥äººçš„å¿ƒæƒ…æˆ–ç”Ÿæ´»ï¼Œè®“å°æ–¹è¦ºå¾—æº«æš–ã€‚" },
                { word: "é‡‹æ‡·", def: "å¿ƒè£¡æœ¬ä¾†å¾ˆåœ¨æ„ã€å¾ˆé›£éï¼Œå¾Œä¾†æƒ³é€šäº†ï¼Œå°±ä¸å†é›£éäº†ã€‚" }
            ]
        },
        {
            char: "ç¥¥",
            pairs: [
                { word: "å‰ç¥¥", def: "é‹æ°£å¥½ï¼Œæœƒæœ‰å¥½äº‹ç™¼ç”Ÿçš„æ¨£å­ã€‚" },
                { word: "ç¥¥å’Œ", def: "æ°£æ°›å¾ˆå®‰éœã€å¾ˆæº«å’Œï¼Œè®“äººè¦ºå¾—å¾ˆèˆ’æœã€‚" },
                { word: "æ…ˆç¥¥", def: "å½¢å®¹é•·è¼©ï¼ˆå¦‚çˆºçˆºå¥¶å¥¶ï¼‰å°äººå¾ˆè¦ªåˆ‡ã€æº«æŸ”çš„æ¨£å­ã€‚" },
                { word: "ç¥¥ç‘", def: "å¥½é‹æ°£çš„å¾µå…†ï¼ˆä¾‹å¦‚ï¼šçœ‹è¦‹å½©è™¹è¦ºå¾—æ˜¯ç¥¥ç‘çš„è±¡å¾µï¼‰ã€‚" },
                { word: "ä¸ç¥¥", def: "æ„Ÿè¦ºå¥½åƒæœƒæœ‰å£äº‹è¦ç™¼ç”Ÿã€‚" }
            ]
        },
        {
            char: "å„€",
            pairs: [
                { word: "å„€å¼", def: "å…¸ç¦®çš„ç¨‹åºå’Œè¦çŸ©ï¼ˆä¾‹å¦‚ï¼šå‡æ——å„€å¼ï¼‰ã€‚" },
                { word: "ç¦®å„€", def: "é€™æ˜¯æœ‰ç¦®è²Œçš„è¡¨ç¾å’Œè¦çŸ©ï¼ˆä¾‹å¦‚ï¼šé¤æ¡Œç¦®å„€ï¼‰ã€‚" },
                { word: "å„€å™¨", def: "åšå¯¦é©—æˆ–æª¢æŸ¥æ™‚ç”¨çš„ç²¾å¯†å™¨å…·ï¼ˆä¾‹å¦‚ï¼šé¡¯å¾®é¡ã€æ¸¬é‡å„€ï¼‰ã€‚" },
                { word: "å¸å„€", def: "åœ¨å…¸ç¦®æˆ–æ´»å‹•å°ä¸Šæ‹¿éº¥å…‹é¢¨ä¸»æŒç¨‹åºçš„äººã€‚" },
                { word: "å„€æ…‹", def: "ä¸€å€‹äººç«™è‘—æˆ–åè‘—çš„å§¿å‹¢å¥½ä¸å¥½çœ‹ã€‚" }
            ]
        },
        {
            char: "åº",
            pairs: [
                { word: "é †åº", def: "ä¾ç…§æ’éšŠçš„å‰å¾Œï¼Œä¸€å€‹æ¥è‘—ä¸€å€‹ä¸æ’éšŠã€‚" },
                { word: "ç§©åº", def: "å¤§å®¶éƒ½èƒ½éµå®ˆè¦å‰‡ï¼Œä¸åµé¬§ä¹Ÿä¸æ··äº‚ã€‚" },
                { word: "ç¨‹åº", def: "åšäº‹æƒ…çš„æ­¥é©Ÿï¼ˆä¾‹å¦‚ï¼šé€™é“èœçš„æ–™ç†ç¨‹åºï¼‰ã€‚" },
                { word: "åºå¹•", def: "è¡¨æ¼”å‰›é–‹å§‹çš„ç¬¬ä¸€å€‹æ®µè½ã€‚" },
                { word: "è‡ªåº", def: "ä½œè€…åœ¨æ›¸çš„æœ€å‰é¢ï¼Œè‡ªå·±å¯«çš„ä¸€ç¯‡æ–‡ç« ï¼Œä»‹ç´¹ç‚ºä»€éº¼è¦å¯«é€™æœ¬æ›¸ã€‚" }
            ]
        },
        {
            char: "æ¯«",
            pairs: [
                { word: "çµ²æ¯«", def: "å½¢å®¹éå¸¸éå¸¸ç´°å¾®ã€å¾ˆå°‘çš„ä¸€é»é»ï¼ˆå¸¸èªªï¼šçµ²æ¯«ä¸åœ¨æ„ï¼‰ã€‚" },
                { word: "æ®æ¯«", def: "æ‹¿è‘—æ¯›ç­†å¯«æ›¸æ³•æˆ–ç•«ç•«ã€‚" },
                { word: "åˆ†æ¯«", def: "å¾ˆå°çš„å–®ä½ï¼Œå½¢å®¹æ¥µå°‘çš„æ•¸é‡ã€‚" },
                { word: "æ¯«ç„¡", def: "å®Œå…¨æ²’æœ‰ã€‚" }
            ]
        },
        {
            char: "æŒ¨",
            pairs: [
                { word: "æŒ¨æ‰“", def: "è¢«æ‰“ã€‚" },
                { word: "æŒ¨ç½µ", def: "è¢«ç½µã€‚" },
                { word: "æŒ¨é¤“", def: "å¿å—è‚šå­é¤“ï¼Œæ²’æœ‰æ±è¥¿åƒã€‚" }
            ]
        },
        {
            char: "å‰",
            pairs: [
                { word: "å‰åˆ©", def: "é †åˆ©ã€é‹æ°£å¥½ï¼Œè¨äººå–œæ­¡çš„å¥½å…†é ­ã€‚" },
                { word: "å‰ç¥¥", def: "é‹æ°£å¥½ï¼Œæœƒæœ‰å¥½äº‹ç™¼ç”Ÿã€‚" },
                { word: "å‰æ™‚", def: "é©åˆåšé‡è¦äº‹æƒ…çš„å¥½æ™‚é–“ã€‚" },
                { word: "å‰æ—¥", def: "é©åˆè¾¦å–œäº‹çš„å¥½æ—¥å­ã€‚" }
            ]
        }
    ];

    // --- é€²åŒ–è¨­å®š ---
    const stages = [
        { name: "å°ç«é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/4.png" },
        { name: "ç«æé¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/5.png" },
        { name: "å™´ç«é¾", img: "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/6.png" }
    ];

    let currentLevelIdx = 0;
    let matchesFound = 0;

    // --- åˆå§‹åŒ– ---
    window.onload = function() {
        loadLevel();
    };

    function loadLevel() {
        const levelData = levels[currentLevelIdx];
        
        // æ›´æ–°æ¨™é¡Œï¼šé¡¯ç¤ºã€Œç¬¬ä¸€é—œï¼šæ…¶ã€
        const chineseNums = ["ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«"];
        document.getElementById('level-header').innerText = `ç¬¬${chineseNums[currentLevelIdx]}é—œï¼š${levelData.char}`;
        
        document.getElementById('stage-indicator').innerText = `ç¬¬ ${currentLevelIdx + 1} / 8 é—œ`;
        document.getElementById('next-btn').style.display = 'none';
        matchesFound = 0;

        // æ›´æ–°å·¦å´å¯¶å¯å¤¢
        updatePokemon();

        // å»ºç«‹é¡Œç›®å€ (Target Boxes)
        const targetsGrid = document.getElementById('targets-grid');
        targetsGrid.innerHTML = '';
        
        levelData.pairs.forEach(pair => {
            let box = document.createElement('div');
            box.className = 'target-box';
            box.dataset.answer = pair.word; 
            
            let defText = document.createElement('div');
            defText.className = 'target-def';
            defText.innerText = pair.def;
            box.appendChild(defText);

            // è¨»å†Šæ”¾ç½®äº‹ä»¶
            box.addEventListener('dragover', handleDragOver);
            box.addEventListener('drop', handleDrop);
            
            targetsGrid.appendChild(box);
        });

        // å»ºç«‹é¸é …å€ (Draggables) - éš¨æ©Ÿæ’åº
        const optionsArea = document.getElementById('options-area');
        optionsArea.innerHTML = '';
        
        let shuffledPairs = [...levelData.pairs].sort(() => 0.5 - Math.random());
        
        shuffledPairs.forEach(pair => {
            let item = document.createElement('div');
            item.className = 'draggable-item';
            item.draggable = true;
            item.innerText = pair.word;
            
            // äº‹ä»¶ç›£è½
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('touchstart', handleTouchStart, {passive: false});
            item.addEventListener('touchmove', handleTouchMove, {passive: false});
            item.addEventListener('touchend', handleTouchEnd);

            optionsArea.appendChild(item);
        });
    }

    function updatePokemon() {
        const img = document.getElementById('poke-img');
        const nameEl = document.getElementById('poke-name');
        let stage = 0;
        
        if (currentLevelIdx >= 2 && currentLevelIdx < 5) stage = 1; // ç«æé¾
        if (currentLevelIdx >= 5) stage = 2; // å™´ç«é¾

        if (img.src !== stages[stage].img) {
            img.classList.add('evolving');
            setTimeout(() => {
                img.src = stages[stage].img;
                nameEl.innerText = stages[stage].name;
                img.classList.remove('evolving');
            }, 500);
        } else {
            img.src = stages[stage].img;
            nameEl.innerText = stages[stage].name;
        }
    }

    // --- æ‹–æ›³é‚è¼¯ ---
    let draggedItem = null;

    function handleDragStart(e) {
        draggedItem = e.target;
        e.dataTransfer.setData('text/plain', e.target.innerText);
    }

    function handleDragOver(e) {
        e.preventDefault(); 
        if (!e.currentTarget.classList.contains('correct')) {
            e.currentTarget.style.borderColor = '#3498db';
        }
    }

    function handleDrop(e) {
        e.preventDefault();
        const box = e.currentTarget;
        if (!box.classList.contains('correct')) {
            box.style.borderColor = '#bdc3c7';
        }
        const word = e.dataTransfer.getData('text/plain');
        checkAnswer(box, word, draggedItem);
    }

    // --- è§¸æ§é‚è¼¯ (æ‰‹æ©Ÿç‰ˆ) ---
    let touchItem = null;

    function handleTouchStart(e) {
        e.preventDefault();
        touchItem = e.target;
        touchItem.style.position = 'fixed';
        touchItem.style.opacity = '0.8';
        touchItem.style.zIndex = '1000';
        const touch = e.touches[0];
        touchItem.style.left = (touch.clientX - touchItem.offsetWidth / 2) + 'px';
        touchItem.style.top = (touch.clientY - touchItem.offsetHeight / 2) + 'px';
    }

    function handleTouchMove(e) {
        if (!touchItem) return;
        e.preventDefault();
        const touch = e.touches[0];
        touchItem.style.left = (touch.clientX - touchItem.offsetWidth / 2) + 'px';
        touchItem.style.top = (touch.clientY - touchItem.offsetHeight / 2) + 'px';
    }

    function handleTouchEnd(e) {
        if (!touchItem) return;
        const touch = e.changedTouches[0];
        touchItem.style.display = 'none';
        let elemBelow = document.elementFromPoint(touch.clientX, touch.clientY);
        touchItem.style.display = 'block';

        let box = elemBelow ? elemBelow.closest('.target-box') : null;

        if (box) {
            checkAnswer(box, touchItem.innerText, touchItem);
        } else {
            resetItemStyle(touchItem);
        }
        touchItem = null;
    }

    function resetItemStyle(item) {
        item.style.position = 'static';
        item.style.opacity = '1';
        item.style.zIndex = '100';
    }

    // --- æ ¸å¿ƒï¼šæª¢æŸ¥ç­”æ¡ˆ (åš´æ ¼æ¨¡å¼) ---
    function checkAnswer(box, userWord, itemEl) {
        if (box.classList.contains('correct')) {
            if(itemEl.style.position === 'fixed') resetItemStyle(itemEl);
            return;
        }

        const correctWord = box.dataset.answer;

        if (userWord === correctWord) {
            // --- ç­”å° ---
            box.classList.add('correct');
            let filledDiv = document.createElement('div');
            filledDiv.className = 'filled-word';
            filledDiv.innerText = userWord;
            box.appendChild(filledDiv);
            itemEl.remove();
            
            matchesFound++;
            
            if (matchesFound === levels[currentLevelIdx].pairs.length) {
                launchConfetti();
                document.getElementById('next-btn').style.display = 'block';
            }

        } else {
            // --- ç­”éŒ¯ (è§¸ç™¼åš´æ ¼é‡ç½®) ---
            if(itemEl.style.position === 'fixed') resetItemStyle(itemEl);
            
            // é¡¯ç¤ºéŒ¯èª¤åŸå› 
            showErrorReason(userWord, correctWord);
        }
    }

    function showErrorReason(userWord, correctWord) {
        const modal = document.getElementById('error-modal');
        const msgText = document.getElementById('error-msg-text');
        
        // é¡¯ç¤ºéŒ¯èª¤åŸå› 
        msgText.innerHTML = `
            ä½ é¸æ“‡äº†ï¼š<span style="color:#d35400; font-weight:bold; font-size:24px;">${userWord}</span><br><br>
            ä½†é€™è£¡çš„æ­£ç¢ºç­”æ¡ˆå…¶å¯¦æ˜¯ï¼š<br>
            <span style="color:#27ae60; font-weight:bold; font-size:28px;">${correctWord}</span><br><br>
            <span style="font-size:16px; color:#555;">(å¿…é ˆå…¨éƒ¨ç­”å°æ‰èƒ½é€²åŒ–ï¼Œè«‹é‡æ–°æŒ‘æˆ°æœ¬é—œï¼)</span>
        `;
        
        modal.style.display = 'flex';
    }

    function resetLevel() {
        // é—œé–‰è¦–çª—ä¸¦é‡ç½®é—œå¡
        document.getElementById('error-modal').style.display = 'none';
        loadLevel(); // é‡æ–°è¼‰å…¥ç›®å‰é—œå¡
    }

    function nextLevel() {
        currentLevelIdx++;
        if (currentLevelIdx >= levels.length) {
            document.querySelector('.left-panel').style.display = 'none';
            document.querySelector('.right-panel').style.display = 'none';
            document.getElementById('end-screen').style.display = 'flex';
            launchConfetti();
        } else {
            loadLevel();
        }
    }

    function launchConfetti() {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 }
        });
    }
</script>

</body>
</html>
